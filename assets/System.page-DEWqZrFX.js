import{w as m,f as F,u as R,a as oe,e as he,j as e,B as $,M as pe,d as re,g as ae,C as ge,n as fe,ae as xe,l as we,m as ve,k as je,af as ye,s as D,a0 as be,a1 as Ce,a6 as O,A as j,S as T,x as C,T as c,y as I,ag as Ae,a4 as Te,a3 as Se}from"./index-D1Sx8b-i.js";import{C as U,T as K}from"./ConfigCard-DoJIrFgo.js";import{I as Pe,B as Y,C as q,D as ke,N as _e}from"./IconRefresh-D5hMuc4W.js";import{P as Ie}from"./PasswordInput-BbJnSpJy.js";import{I as Z}from"./IconUpload-COAwluOZ.js";import{I as ee}from"./IconWifi-BRcoE8EH.js";function Re({timeout:a=2e3}={}){const[i,s]=m.useState(null),[o,l]=m.useState(!1),[n,p]=m.useState(null),d=x=>{window.clearTimeout(n),p(window.setTimeout(()=>l(!1),a)),l(x)};return{copy:x=>{"clipboard"in navigator?navigator.clipboard.writeText(x).then(()=>d(!0)).catch(h=>s(h)):s(new Error("useClipboard: navigator.clipboard is not supported"))},reset:()=>{l(!1),s(null),window.clearTimeout(n)},error:i,copied:o}}var ne={root:"m_66836ed3",wrapper:"m_a5d60502",body:"m_667c2793",title:"m_6a03f287",label:"m_698f4f23",icon:"m_667f2a6a",message:"m_7fa78076",closeButton:"m_87f54839"};const ze={},Be=re((a,{radius:i,color:s,variant:o,autoContrast:l})=>{const n=a.variantColorResolver({color:s||a.primaryColor,theme:a,variant:o||"light",autoContrast:l});return{root:{"--alert-radius":i===void 0?void 0:ae(i),"--alert-bg":s||o?n.background:void 0,"--alert-color":n.color,"--alert-bd":s||o?n.border:void 0}}}),M=F((a,i)=>{const s=R("Alert",ze,a),{classNames:o,className:l,style:n,styles:p,unstyled:d,vars:g,radius:f,color:x,title:h,children:w,id:A,icon:b,withCloseButton:u,onClose:S,closeButtonLabel:H,variant:P,autoContrast:k,...G}=s,v=oe({name:"Alert",classes:ne,props:s,className:l,style:n,classNames:o,styles:p,unstyled:d,vars:g,varsResolver:Be}),B=he(A),y=h&&`${B}-title`||void 0,_=`${B}-body`;return e.jsx($,{id:B,...v("root",{variant:P}),variant:P,ref:i,...G,role:"alert","aria-describedby":_,"aria-labelledby":y,children:e.jsxs("div",{...v("wrapper"),children:[b&&e.jsx("div",{...v("icon"),children:b}),e.jsxs("div",{...v("body"),children:[h&&e.jsx("div",{...v("title"),"data-with-close-button":u||void 0,children:e.jsx("span",{id:y,...v("label"),children:h})}),w&&e.jsx("div",{id:_,...v("message"),"data-variant":P,children:w})]}),u&&e.jsx(pe,{...v("closeButton"),onClick:S,variant:"transparent",size:16,iconSize:16,"aria-label":H,unstyled:d})]})})});M.classes=ne;M.displayName="@mantine/core/Alert";const Oe={timeout:1e3};function ie(a){const{children:i,timeout:s,value:o,...l}=R("CopyButton",Oe,a),n=Re({timeout:s}),p=()=>n.copy(o);return e.jsx(e.Fragment,{children:i({copy:p,copied:n.copied,...l})})}ie.displayName="@mantine/core/CopyButton";const[Fe,le]=ge("Progress.Root component was not found in tree");var N={root:"m_db6d6462",section:"m_2242eb65","stripes-animation":"m_81a374bd",label:"m_91e40b74"};const Ne={},J=F((a,i)=>{const{classNames:s,className:o,style:l,styles:n,vars:p,...d}=R("ProgressLabel",Ne,a),g=le();return e.jsx($,{ref:i,...g.getStyles("label",{className:o,style:l,classNames:s,styles:n}),...d})});J.classes=N;J.displayName="@mantine/core/ProgressLabel";const Le={},Ue=re((a,{size:i,radius:s,transitionDuration:o})=>({root:{"--progress-size":fe(i,"progress-size"),"--progress-radius":s===void 0?void 0:ae(s),"--progress-transition-duration":typeof o=="number"?`${o}ms`:void 0}})),E=F((a,i)=>{const s=R("ProgressRoot",Le,a),{classNames:o,className:l,style:n,styles:p,unstyled:d,vars:g,autoContrast:f,transitionDuration:x,...h}=s,w=oe({name:"Progress",classes:N,props:s,className:l,style:n,classNames:o,styles:p,unstyled:d,vars:g,varsResolver:Ue});return e.jsx(Fe,{value:{getStyles:w,autoContrast:f},children:e.jsx($,{ref:i,...w("root"),...h})})});E.classes=N;E.displayName="@mantine/core/ProgressRoot";const Me={withAria:!0},W=F((a,i)=>{const{classNames:s,className:o,style:l,styles:n,vars:p,value:d,withAria:g,color:f,striped:x,animated:h,mod:w,...A}=R("ProgressSection",Me,a),b=le(),u=xe(),S=g?{role:"progressbar","aria-valuemax":100,"aria-valuemin":0,"aria-valuenow":d,"aria-valuetext":`${d}%`}:{};return e.jsx($,{ref:i,...b.getStyles("section",{className:o,classNames:s,styles:n,style:l}),...A,...S,mod:[{striped:x||h,animated:h},w],__vars:{"--progress-section-width":`${d}%`,"--progress-section-color":je(f,u),"--progress-label-color":we(b.autoContrast,u)?ve({color:f,theme:u,autoContrast:b.autoContrast}):void 0}})});W.classes=N;W.displayName="@mantine/core/ProgressSection";const $e={},z=F((a,i)=>{const s=R("Progress",$e,a),{value:o,classNames:l,styles:n,vars:p,color:d,striped:g,animated:f,"aria-label":x,...h}=s,{resolvedClassNames:w,resolvedStyles:A}=ye({classNames:l,styles:n,props:s});return e.jsx(E,{ref:i,classNames:w,styles:A,vars:p,...h,children:e.jsx(W,{value:o,color:d,striped:g,animated:f,"aria-label":x})})});z.classes=N;z.displayName="@mantine/core/Progress";z.Section=W;z.Root=E;z.Label=J;/**
 * @license @tabler/icons-react v3.29.0 - MIT
 *
 * This source code is licensed under the MIT license.
 * See the LICENSE file in the root directory of this source tree.
 */var De=D("outline","alert-triangle","IconAlertTriangle",[["path",{d:"M12 9v4",key:"svg-0"}],["path",{d:"M10.363 3.591l-8.106 13.534a1.914 1.914 0 0 0 1.636 2.871h16.214a1.914 1.914 0 0 0 1.636 -2.87l-8.106 -13.536a1.914 1.914 0 0 0 -3.274 0z",key:"svg-1"}],["path",{d:"M12 16h.01",key:"svg-2"}]]);/**
 * @license @tabler/icons-react v3.29.0 - MIT
 *
 * This source code is licensed under the MIT license.
 * See the LICENSE file in the root directory of this source tree.
 */var se=D("outline","arrow-back","IconArrowBack",[["path",{d:"M9 11l-4 4l4 4m-4 -4h11a4 4 0 0 0 0 -8h-1",key:"svg-0"}]]);/**
 * @license @tabler/icons-react v3.29.0 - MIT
 *
 * This source code is licensed under the MIT license.
 * See the LICENSE file in the root directory of this source tree.
 */var Ee=D("outline","check","IconCheck",[["path",{d:"M5 12l5 5l10 -10",key:"svg-0"}]]);/**
 * @license @tabler/icons-react v3.29.0 - MIT
 *
 * This source code is licensed under the MIT license.
 * See the LICENSE file in the root directory of this source tree.
 */var te=D("outline","cloud-download","IconCloudDownload",[["path",{d:"M19 18a3.5 3.5 0 0 0 0 -7h-1a5 4.5 0 0 0 -11 -2a4.6 4.4 0 0 0 -2.1 8.4",key:"svg-0"}],["path",{d:"M12 13l0 9",key:"svg-1"}],["path",{d:"M9 19l3 3l3 -3",key:"svg-2"}]]);const Je=()=>{const a=be(),i=Ce({uuid:"4880c12c-fdcb-4077-8920-a450d7f9b907"}),{characteristic:s}=i.useBluetoothCharacteristic({uuid:"fec26ec4-6d71-4442-9f81-55bc21d658d6"}),[o,l]=m.useState(null),[n,p]=m.useState(!1),[d,g]=m.useState("BT_GW_OTA"),[f,x]=m.useState("paramount123"),[h,w]=m.useState(300),[A,b]=m.useState(!1),[u,S]=m.useState(null),[H,P]=m.useState(!1),[k,G]=m.useState(""),[v,B]=m.useState(""),[y,_]=m.useState(null),[L,V]=m.useState(!1);m.useEffect(()=>{a.isConnected&&s&&Q()},[a.isConnected,s]);const Q=async()=>{if(s){p(!0);try{const r=await new O(s).sendCommand({cmd:"GET_VERSION",section:"system",data:{}});r.status==="success"&&r.data&&l(r.data)}catch(t){const r=t instanceof Error?t.message:"Unknown error";j.show({message:`Failed to load firmware info: ${r}`,color:"red"})}finally{p(!1)}}},ce=async()=>{if(s){if(f.length<8){j.show({message:"Password must be at least 8 characters",color:"red"});return}P(!0);try{const r=await new O(s).sendCommand({cmd:"START_OTA_AP",section:"system",data:{ssid:d,password:f,timeout_sec:h}});r.status==="success"&&r.data&&(b(!0),S({ssid:r.data.ssid,ip:r.data.ip,url:r.data.url}),j.show({message:"OTA Access Point started! Connect to the WiFi network.",color:"green"}))}catch(t){const r=t instanceof Error?t.message:"Unknown error";j.show({message:`Failed to start OTA AP: ${r}`,color:"red"})}finally{P(!1)}}},X=async()=>{if(s)try{await new O(s).sendCommand({cmd:"STOP_OTA",section:"system",data:{}}),b(!1),S(null),V(!1),_(null),j.show({message:"OTA cancelled",color:"blue"})}catch(t){const r=t instanceof Error?t.message:"Unknown error";j.show({message:`Failed to stop OTA: ${r}`,color:"red"})}},de=async()=>{if(s){if(!k.startsWith("http://")&&!k.startsWith("https://")){j.show({message:"Please enter a valid HTTP/HTTPS URL",color:"red"});return}V(!0),_({state:0,progress:0,bytes_written:0,total_bytes:0,message:"Starting download..."});try{const r=await new O(s).sendCommand({cmd:"OTA_UPDATE",section:"system",data:{url:k,md5:v||void 0}},12e4);if(r.status==="error")throw new Error(r.message||"OTA failed");j.show({message:"Firmware download started. Device will reboot when complete.",color:"blue"})}catch(t){const r=t instanceof Error?t.message:"Unknown error";j.show({message:`OTA failed: ${r}`,color:"red"}),V(!1),_(null)}}},ue=async()=>{if(!(!s||!window.confirm("Are you sure you want to rollback to the previous firmware version? The device will reboot.")))try{await new O(s).sendCommand({cmd:"ROLLBACK",section:"system",data:{}}),j.show({message:"Rolling back to previous firmware...",color:"blue"})}catch(r){const me=r instanceof Error?r.message:"Unknown error";j.show({message:`Rollback failed: ${me}`,color:"red"})}};return e.jsxs(T,{gap:"md",children:[e.jsxs(C,{justify:"space-between",children:[e.jsx(c,{size:"xl",fw:700,children:"System & Firmware"}),e.jsx(I,{variant:"light",leftSection:e.jsx(Pe,{size:16}),onClick:Q,loading:n,children:"Refresh"})]}),e.jsx(U,{title:"Firmware Information",icon:e.jsx(Ae,{size:20}),children:o?e.jsxs(T,{gap:"sm",children:[e.jsxs(C,{children:[e.jsx(c,{fw:500,children:"Version:"}),e.jsx(Y,{size:"lg",variant:"filled",color:"blue",children:o.firmware_version})]}),e.jsxs(C,{children:[e.jsx(c,{fw:500,children:"Build Date:"}),e.jsx(c,{c:"dimmed",children:o.build_date})]}),e.jsxs(C,{children:[e.jsx(c,{fw:500,children:"Partition:"}),e.jsx(q,{children:o.partition_info})]}),e.jsx(ke,{my:"xs"}),e.jsxs(C,{children:[e.jsx(c,{fw:500,children:"Free Heap:"}),e.jsxs(c,{c:"dimmed",children:[(o.free_heap/1024).toFixed(1)," KB"]})]}),e.jsxs(C,{children:[e.jsx(c,{fw:500,children:"Flash Size:"}),e.jsxs(c,{c:"dimmed",children:[(o.flash_size/1024/1024).toFixed(1)," MB"]})]})]}):e.jsx(c,{c:"dimmed",children:"Click Refresh to load firmware information"})}),e.jsx(U,{title:"Local OTA Update (WiFi AP Mode)",icon:e.jsx(ee,{size:20}),children:e.jsxs(T,{gap:"md",children:[e.jsx(M,{icon:e.jsx(De,{size:16}),color:"yellow",children:"This will temporarily disconnect the gateway from the network and create a WiFi hotspot for firmware upload. BLE connection may be lost during the update."}),A?e.jsxs(e.Fragment,{children:[e.jsx(M,{icon:e.jsx(ee,{size:16}),color:"green",title:"OTA Access Point Active",children:e.jsxs(T,{gap:"xs",children:[e.jsxs(c,{size:"sm",children:[e.jsx("strong",{children:"1."})," Disconnect from this BLE connection"]}),e.jsxs(c,{size:"sm",children:[e.jsx("strong",{children:"2."})," Connect your device to WiFi network:"," ",e.jsx(q,{fw:700,children:u==null?void 0:u.ssid})]}),e.jsxs(c,{size:"sm",children:[e.jsx("strong",{children:"3."})," Open browser and go to:"," ",e.jsxs(C,{gap:"xs",style:{display:"inline-flex"},children:[e.jsx(q,{fw:700,children:u==null?void 0:u.url}),e.jsx(ie,{value:(u==null?void 0:u.url)||"",children:({copied:t,copy:r})=>e.jsx(Te,{label:t?"Copied!":"Copy URL",children:e.jsx(Se,{size:"sm",variant:"subtle",onClick:r,color:t?"green":"gray",children:t?e.jsx(Ee,{size:14}):e.jsx(Z,{size:14})})})})]})]}),e.jsxs(c,{size:"sm",children:[e.jsx("strong",{children:"4."})," Upload the .bin firmware file"]})]})}),e.jsx(I,{color:"red",variant:"outline",onClick:X,children:"Cancel OTA Mode"})]}):e.jsxs(e.Fragment,{children:[e.jsx(K,{label:"AP Network Name (SSID)",value:d,onChange:t=>g(t.currentTarget.value),placeholder:"BT_GW_OTA"}),e.jsx(Ie,{label:"AP Password",value:f,onChange:t=>x(t.currentTarget.value),description:"Minimum 8 characters"}),e.jsx(_e,{label:"Timeout (seconds)",value:h,onChange:t=>w(t),min:60,max:600,step:30,description:"AP will auto-disable after this time if no update occurs"}),e.jsx(I,{leftSection:e.jsx(Z,{size:16}),onClick:ce,loading:H,children:"Start OTA Access Point"})]})]})}),e.jsx(U,{title:"Cloud OTA Update (URL Download)",icon:e.jsx(te,{size:20}),children:e.jsxs(T,{gap:"md",children:[e.jsx(c,{size:"sm",c:"dimmed",children:"Download firmware directly from a public URL (GitHub releases, S3, etc.)"}),e.jsx(K,{label:"Firmware URL",placeholder:"https://github.com/user/repo/releases/download/v1.0/firmware.bin",value:k,onChange:t=>G(t.currentTarget.value),description:"Public URL to firmware binary file (.bin)"}),e.jsx(K,{label:"MD5 Hash (Optional)",placeholder:"e.g., d41d8cd98f00b204e9800998ecf8427e",value:v,onChange:t=>B(t.currentTarget.value),description:"32-character MD5 hash for integrity verification"}),y&&e.jsxs(T,{gap:"xs",children:[e.jsxs(C,{justify:"space-between",children:[e.jsx(c,{size:"sm",fw:500,children:y.message}),e.jsxs(Y,{children:[y.progress,"%"]})]}),e.jsx(z,{value:y.progress,animated:L,size:"lg"}),y.total_bytes>0&&e.jsxs(c,{size:"xs",c:"dimmed",ta:"center",children:[(y.bytes_written/1024).toFixed(0)," / ",(y.total_bytes/1024).toFixed(0)," KB"]})]}),e.jsxs(C,{children:[e.jsx(I,{leftSection:e.jsx(te,{size:16}),onClick:de,loading:L,disabled:!k||L,children:"Download & Update"}),L&&e.jsx(I,{color:"red",variant:"outline",onClick:X,children:"Cancel"})]})]})}),e.jsx(U,{title:"Firmware Rollback",icon:e.jsx(se,{size:20}),children:e.jsxs(T,{gap:"sm",children:[e.jsx(c,{size:"sm",c:"dimmed",children:"If the current firmware has issues, you can rollback to the previous version. This requires a dual-partition OTA setup."}),e.jsx(I,{color:"orange",variant:"outline",leftSection:e.jsx(se,{size:16}),onClick:ue,children:"Rollback to Previous Version"})]})})]})};export{Je as default};
