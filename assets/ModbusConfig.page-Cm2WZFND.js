import{C as pe,w as y,D as Ae,e as ze,E as Be,F as De,j as e,O as ke,R as Pe,B as ne,H as Oe,J as Fe,K as ee,L as W,M as Le,N as je,P as $e,Q as ve,V as Ve,u as L,W as Ue,X as Ge,f as G,r as xe,a as He,d as qe,n as Xe,g as Ze,c as We,s as J,S as F,G as f,v as Z,Y as Ye,Z as Je,T as v,_ as Ke,x as N,$ as ae,a0 as Qe,y as k,a1 as es,A as z,a2 as ss,t as me,a3 as as,a4 as ns}from"./index-D6VHSR8u.js";import{C as he}from"./ConfigCard-w85yHWU2.js";import{B as ts,D as ls,P as is,S as rs,V as B,F as os,a as ds,E as cs}from"./configOptions-DaY-HE-t.js";import{N as X,C as A,D as ge}from"./NumberInput-0BDd8lZv.js";import{B as fe,I as us}from"./IconRefresh-EBEQJ55s.js";import{A as U,T as h}from"./Table-DEmgSPKl.js";import{T as Q}from"./TextInput-B2nxoM_K.js";import{u as hs}from"./useConfiguration-Ct0XTJf2.js";import{I as xs}from"./IconDownload-BZPXOe5T.js";import{I as ms}from"./IconUpload-_Ztc1gtm.js";const[gs,$]=pe("ModalBase component was not found in tree");function fs({opened:s,transitionDuration:n}){const[i,a]=y.useState(s),o=y.useRef(-1),c=Ae()?0:n;return y.useEffect(()=>(s?(a(!0),window.clearTimeout(o.current)):c===0?a(!1):o.current=window.setTimeout(()=>a(!1),c),()=>window.clearTimeout(o.current)),[s,c]),i}function ps({id:s,transitionProps:n,opened:i,trapFocus:a,closeOnEscape:o,onClose:d,returnFocus:c}){const r=ze(s),[x,m]=y.useState(!1),[j,C]=y.useState(!1),b=typeof(n==null?void 0:n.duration)=="number"?n==null?void 0:n.duration:200,l=fs({opened:i,transitionDuration:b});return Be("keydown",w=>{var M;w.key==="Escape"&&o&&i&&((M=w.target)==null?void 0:M.getAttribute("data-mantine-stop-propagation"))!=="true"&&d()},{capture:!0}),De({opened:i,shouldReturnFocus:a&&c}),{_id:r,titleMounted:x,bodyMounted:j,shouldLockScroll:l,setTitleMounted:m,setBodyMounted:C}}const be=y.forwardRef(({keepMounted:s,opened:n,onClose:i,id:a,transitionProps:o,onExitTransitionEnd:d,onEnterTransitionEnd:c,trapFocus:r,closeOnEscape:x,returnFocus:m,closeOnClickOutside:j,withinPortal:C,portalProps:b,lockScroll:l,children:w,zIndex:M,shadow:_,padding:u,__vars:T,unstyled:g,removeScrollProps:p,...S},E)=>{const{_id:I,titleMounted:R,bodyMounted:D,shouldLockScroll:H,setTitleMounted:se,setBodyMounted:t}=ps({id:a,transitionProps:o,opened:n,trapFocus:r,closeOnEscape:x,onClose:i,returnFocus:m}),{key:O,...q}=p||{};return e.jsx(ke,{...b,withinPortal:C,children:e.jsx(gs,{value:{opened:n,onClose:i,closeOnClickOutside:j,onExitTransitionEnd:d,onEnterTransitionEnd:c,transitionProps:{...o,keepMounted:s},getTitleId:()=>`${I}-title`,getBodyId:()=>`${I}-body`,titleMounted:R,bodyMounted:D,setTitleMounted:se,setBodyMounted:t,trapFocus:r,closeOnEscape:x,zIndex:M,unstyled:g},children:e.jsx(Pe,{enabled:H&&l,...q,children:e.jsx(ne,{ref:E,...S,__vars:{...T,"--mb-z-index":(M||ee("modal")).toString(),"--mb-shadow":Fe(_),"--mb-padding":Oe(u)},children:w})},O)})})});be.displayName="@mantine/core/ModalBase";function js(){const s=$();return y.useEffect(()=>(s.setBodyMounted(!0),()=>s.setBodyMounted(!1)),[]),s.getBodyId()}var Y={title:"m_615af6c9",header:"m_b5489c3c",inner:"m_60c222c7",content:"m_fd1ab0aa",close:"m_606cb269",body:"m_5df29311"};const ye=y.forwardRef(({className:s,...n},i)=>{const a=js(),o=$();return e.jsx(ne,{ref:i,...n,id:a,className:W({[Y.body]:!o.unstyled},s)})});ye.displayName="@mantine/core/ModalBaseBody";const _e=y.forwardRef(({className:s,onClick:n,...i},a)=>{const o=$();return e.jsx(Le,{ref:a,...i,onClick:d=>{o.onClose(),n==null||n(d)},className:W({[Y.close]:!o.unstyled},s),unstyled:o.unstyled})});_e.displayName="@mantine/core/ModalBaseCloseButton";const Se=y.forwardRef(({transitionProps:s,className:n,innerProps:i,onKeyDown:a,style:o,...d},c)=>{const r=$();return e.jsx(je,{mounted:r.opened,transition:"pop",...r.transitionProps,onExited:()=>{var x,m,j;(x=r.onExitTransitionEnd)==null||x.call(r),(j=(m=r.transitionProps)==null?void 0:m.onExited)==null||j.call(m)},onEntered:()=>{var x,m,j;(x=r.onEnterTransitionEnd)==null||x.call(r),(j=(m=r.transitionProps)==null?void 0:m.onEntered)==null||j.call(m)},...s,children:x=>e.jsx("div",{...i,className:W({[Y.inner]:!r.unstyled},i.className),children:e.jsx($e,{active:r.opened&&r.trapFocus,innerRef:c,children:e.jsx(ve,{...d,component:"section",role:"dialog",tabIndex:-1,"aria-modal":!0,"aria-describedby":r.bodyMounted?r.getBodyId():void 0,"aria-labelledby":r.titleMounted?r.getTitleId():void 0,style:[o,x],className:W({[Y.content]:!r.unstyled},n),unstyled:r.unstyled,children:d.children})})})})});Se.displayName="@mantine/core/ModalBaseContent";const Ce=y.forwardRef(({className:s,...n},i)=>{const a=$();return e.jsx(ne,{component:"header",ref:i,className:W({[Y.header]:!a.unstyled},s),...n})});Ce.displayName="@mantine/core/ModalBaseHeader";const vs={duration:200,timingFunction:"ease",transition:"fade"};function bs(s){const n=$();return{...vs,...n.transitionProps,...s}}const Me=y.forwardRef(({onClick:s,transitionProps:n,style:i,visible:a,...o},d)=>{const c=$(),r=bs(n);return e.jsx(je,{mounted:a!==void 0?a:c.opened,...r,transition:"fade",children:x=>e.jsx(Ve,{ref:d,fixed:!0,style:[i,x],zIndex:c.zIndex,unstyled:c.unstyled,onClick:m=>{s==null||s(m),c.closeOnClickOutside&&c.onClose()},...o})})});Me.displayName="@mantine/core/ModalBaseOverlay";function ys(){const s=$();return y.useEffect(()=>(s.setTitleMounted(!0),()=>s.setTitleMounted(!1)),[]),s.getTitleId()}const Te=y.forwardRef(({className:s,...n},i)=>{const a=ys(),o=$();return e.jsx(ne,{component:"h2",ref:i,className:W({[Y.title]:!o.unstyled},s),...n,id:a})});Te.displayName="@mantine/core/ModalBaseTitle";function _s({children:s}){return e.jsx(e.Fragment,{children:s})}const Ss={multiple:!1},we=y.forwardRef((s,n)=>{const{onChange:i,children:a,multiple:o,accept:d,name:c,form:r,resetRef:x,disabled:m,capture:j,inputProps:C,...b}=L("FileButton",Ss,s),l=y.useRef(null),w=()=>{var u;!m&&((u=l.current)==null||u.click())},M=u=>{i(o?Array.from(u.currentTarget.files):u.currentTarget.files[0]||null)};return Ue(x,()=>{l.current&&(l.current.value="")}),e.jsxs(e.Fragment,{children:[a({onClick:w,...b}),e.jsx("input",{style:{display:"none"},type:"file",accept:d,multiple:o,onChange:M,ref:Ge(n,l),name:c,form:r,capture:j,...C})]})});we.displayName="@mantine/core/FileButton";const[Cs,K]=pe("Modal component was not found in tree");var V={root:"m_9df02822",content:"m_54c44539",inner:"m_1f958f16",header:"m_d0e2b9cd"};const Ms={},te=G((s,n)=>{const i=L("ModalBody",Ms,s),{classNames:a,className:o,style:d,styles:c,vars:r,...x}=i,m=K();return e.jsx(ye,{ref:n,...m.getStyles("body",{classNames:a,style:d,styles:c,className:o}),...x})});te.classes=V;te.displayName="@mantine/core/ModalBody";const Ts={},le=G((s,n)=>{const i=L("ModalCloseButton",Ts,s),{classNames:a,className:o,style:d,styles:c,vars:r,...x}=i,m=K();return e.jsx(_e,{ref:n,...m.getStyles("close",{classNames:a,style:d,styles:c,className:o}),...x})});le.classes=V;le.displayName="@mantine/core/ModalCloseButton";const ws={},ie=G((s,n)=>{const i=L("ModalContent",ws,s),{classNames:a,className:o,style:d,styles:c,vars:r,children:x,__hidden:m,...j}=i,C=K(),b=C.scrollAreaComponent||_s;return e.jsx(Se,{...C.getStyles("content",{className:o,style:d,styles:c,classNames:a}),innerProps:C.getStyles("inner",{className:o,style:d,styles:c,classNames:a}),"data-full-screen":C.fullScreen||void 0,"data-modal-content":!0,"data-hidden":m||void 0,ref:n,...j,children:e.jsx(b,{style:{maxHeight:C.fullScreen?"100dvh":`calc(100dvh - (${xe(C.yOffset)} * 2))`},children:x})})});ie.classes=V;ie.displayName="@mantine/core/ModalContent";const Is={},re=G((s,n)=>{const i=L("ModalHeader",Is,s),{classNames:a,className:o,style:d,styles:c,vars:r,...x}=i,m=K();return e.jsx(Ce,{ref:n,...m.getStyles("header",{classNames:a,style:d,styles:c,className:o}),...x})});re.classes=V;re.displayName="@mantine/core/ModalHeader";const Rs={},oe=G((s,n)=>{const i=L("ModalOverlay",Rs,s),{classNames:a,className:o,style:d,styles:c,vars:r,...x}=i,m=K();return e.jsx(Me,{ref:n,...m.getStyles("overlay",{classNames:a,style:d,styles:c,className:o}),...x})});oe.classes=V;oe.displayName="@mantine/core/ModalOverlay";const Ns={__staticSelector:"Modal",closeOnClickOutside:!0,withinPortal:!0,lockScroll:!0,trapFocus:!0,returnFocus:!0,closeOnEscape:!0,keepMounted:!1,zIndex:ee("modal"),transitionProps:{duration:200,transition:"fade-down"},yOffset:"5dvh"},Es=qe((s,{radius:n,size:i,yOffset:a,xOffset:o})=>({root:{"--modal-radius":n===void 0?void 0:Ze(n),"--modal-size":Xe(i,"modal-size"),"--modal-y-offset":xe(a),"--modal-x-offset":xe(o)}})),de=G((s,n)=>{const i=L("ModalRoot",Ns,s),{classNames:a,className:o,style:d,styles:c,unstyled:r,vars:x,yOffset:m,scrollAreaComponent:j,radius:C,fullScreen:b,centered:l,xOffset:w,__staticSelector:M,..._}=i,u=He({name:M,classes:V,props:i,className:o,style:d,classNames:a,styles:c,unstyled:r,vars:x,varsResolver:Es});return e.jsx(Cs,{value:{yOffset:m,scrollAreaComponent:j,getStyles:u,fullScreen:b},children:e.jsx(be,{ref:n,...u("root"),"data-full-screen":b||void 0,"data-centered":l||void 0,unstyled:r,..._})})});de.classes=V;de.displayName="@mantine/core/ModalRoot";const[As,zs]=We();function Ie({children:s}){const[n,i]=y.useState([]),[a,o]=y.useState(ee("modal"));return e.jsx(As,{value:{stack:n,addModal:(d,c)=>{i(r=>[...new Set([...r,d])]),o(r=>typeof c=="number"&&typeof r=="number"?Math.max(r,c):r)},removeModal:d=>i(c=>c.filter(r=>r!==d)),getZIndex:d=>`calc(${a} + ${n.indexOf(d)} + 1)`,currentId:n[n.length-1],maxZIndex:a},children:s})}Ie.displayName="@mantine/core/ModalStack";const Bs={},ce=G((s,n)=>{const i=L("ModalTitle",Bs,s),{classNames:a,className:o,style:d,styles:c,vars:r,...x}=i,m=K();return e.jsx(Te,{ref:n,...m.getStyles("title",{classNames:a,style:d,styles:c,className:o}),...x})});ce.classes=V;ce.displayName="@mantine/core/ModalTitle";const Ds={closeOnClickOutside:!0,withinPortal:!0,lockScroll:!0,trapFocus:!0,returnFocus:!0,closeOnEscape:!0,keepMounted:!1,zIndex:ee("modal"),transitionProps:{duration:200,transition:"fade-down"},withOverlay:!0,withCloseButton:!0},P=G((s,n)=>{const{title:i,withOverlay:a,overlayProps:o,withCloseButton:d,closeButtonProps:c,children:r,radius:x,opened:m,stackId:j,zIndex:C,...b}=L("Modal",Ds,s),l=zs(),w=!!i||d,M=l&&j?{closeOnEscape:l.currentId===j,trapFocus:l.currentId===j,zIndex:l.getZIndex(j)}:{},_=a===!1?!1:j&&l?l.currentId===j:m;return y.useEffect(()=>{l&&j&&(m?l.addModal(j,C||ee("modal")):l.removeModal(j))},[m,j,C]),e.jsxs(de,{ref:n,radius:x,opened:m,zIndex:l&&j?l.getZIndex(j):C,...b,...M,children:[a&&e.jsx(oe,{visible:_,transitionProps:l&&j?{duration:0}:void 0,...o}),e.jsxs(ie,{radius:x,__hidden:l&&j&&m?j!==l.currentId:!1,children:[w&&e.jsxs(re,{children:[i&&e.jsx(ce,{children:i}),d&&e.jsx(le,{...c})]}),e.jsx(te,{children:r})]})]})});P.classes=V;P.displayName="@mantine/core/Modal";P.Root=de;P.Overlay=oe;P.Content=ie;P.Body=te;P.Header=re;P.Title=ce;P.CloseButton=le;P.Stack=Ie;/**
 * @license @tabler/icons-react v3.29.0 - MIT
 *
 * This source code is licensed under the MIT license.
 * See the LICENSE file in the root directory of this source tree.
 */var ks=J("outline","devices","IconDevices",[["path",{d:"M13 9a1 1 0 0 1 1 -1h6a1 1 0 0 1 1 1v10a1 1 0 0 1 -1 1h-6a1 1 0 0 1 -1 -1v-10z",key:"svg-0"}],["path",{d:"M18 8v-3a1 1 0 0 0 -1 -1h-13a1 1 0 0 0 -1 1v12a1 1 0 0 0 1 1h9",key:"svg-1"}],["path",{d:"M16 9h2",key:"svg-2"}]]);/**
 * @license @tabler/icons-react v3.29.0 - MIT
 *
 * This source code is licensed under the MIT license.
 * See the LICENSE file in the root directory of this source tree.
 */var Re=J("outline","edit","IconEdit",[["path",{d:"M7 7h-1a2 2 0 0 0 -2 2v9a2 2 0 0 0 2 2h9a2 2 0 0 0 2 -2v-1",key:"svg-0"}],["path",{d:"M20.385 6.585a2.1 2.1 0 0 0 -2.97 -2.97l-8.415 8.385v3h3l8.385 -8.415z",key:"svg-1"}],["path",{d:"M16 5l3 3",key:"svg-2"}]]);/**
 * @license @tabler/icons-react v3.29.0 - MIT
 *
 * This source code is licensed under the MIT license.
 * See the LICENSE file in the root directory of this source tree.
 */var Ps=J("outline","file-export","IconFileExport",[["path",{d:"M14 3v4a1 1 0 0 0 1 1h4",key:"svg-0"}],["path",{d:"M11.5 21h-4.5a2 2 0 0 1 -2 -2v-14a2 2 0 0 1 2 -2h7l5 5v5m-5 6h7m-3 -3l3 3l-3 3",key:"svg-1"}]]);/**
 * @license @tabler/icons-react v3.29.0 - MIT
 *
 * This source code is licensed under the MIT license.
 * See the LICENSE file in the root directory of this source tree.
 */var Os=J("outline","player-pause","IconPlayerPause",[["path",{d:"M6 5m0 1a1 1 0 0 1 1 -1h2a1 1 0 0 1 1 1v12a1 1 0 0 1 -1 1h-2a1 1 0 0 1 -1 -1z",key:"svg-0"}],["path",{d:"M14 5m0 1a1 1 0 0 1 1 -1h2a1 1 0 0 1 1 1v12a1 1 0 0 1 -1 1h-2a1 1 0 0 1 -1 -1z",key:"svg-1"}]]);/**
 * @license @tabler/icons-react v3.29.0 - MIT
 *
 * This source code is licensed under the MIT license.
 * See the LICENSE file in the root directory of this source tree.
 */var Ne=J("outline","plus","IconPlus",[["path",{d:"M12 5l0 14",key:"svg-0"}],["path",{d:"M5 12l14 0",key:"svg-1"}]]);/**
 * @license @tabler/icons-react v3.29.0 - MIT
 *
 * This source code is licensed under the MIT license.
 * See the LICENSE file in the root directory of this source tree.
 */var Ee=J("outline","trash","IconTrash",[["path",{d:"M4 7l16 0",key:"svg-0"}],["path",{d:"M10 11l0 6",key:"svg-1"}],["path",{d:"M14 11l0 6",key:"svg-2"}],["path",{d:"M5 7l1 12a2 2 0 0 0 2 2h8a2 2 0 0 0 2 -2l1 -12",key:"svg-3"}],["path",{d:"M9 7v-3a1 1 0 0 1 1 -1h4a1 1 0 0 1 1 1v3",key:"svg-4"}]]);const Fs=({config:s,onChange:n})=>{const i=a=>{n({...s,...a})};return e.jsx(F,{gap:"md",children:e.jsxs(f,{children:[e.jsx(f.Col,{span:{base:12,sm:6},children:e.jsx(Z,{label:"Baud Rate",value:String(s.baud_rate),onChange:a=>i({baud_rate:Number(a)}),data:ts.map(a=>({value:String(a),label:String(a)})),required:!0})}),e.jsx(f.Col,{span:{base:12,sm:6},children:e.jsx(Z,{label:"Data Bits",value:String(s.data_bits),onChange:a=>i({data_bits:Number(a)}),data:ls.map(a=>({value:String(a.value),label:a.label})),required:!0})}),e.jsx(f.Col,{span:{base:12,sm:6},children:e.jsx(Z,{label:"Parity",value:s.parity,onChange:a=>i({parity:a}),data:is.map(a=>({value:a.value,label:a.label})),required:!0})}),e.jsx(f.Col,{span:{base:12,sm:6},children:e.jsx(Z,{label:"Stop Bits",value:String(s.stop_bits),onChange:a=>i({stop_bits:Number(a)}),data:rs.map(a=>({value:String(a.value),label:a.label})),required:!0})}),e.jsx(f.Col,{span:{base:12,sm:6},children:e.jsx(X,{label:"Timeout (ms)",value:s.timeout_ms,onChange:a=>i({timeout_ms:Number(a)}),min:100,max:5e3,step:100,required:!0})})]})})},Ls=({slaves:s,onEdit:n,onDelete:i,onAdd:a})=>{const o=Ye(),d=Je({uuid:"4880c12c-fdcb-4077-8920-a450d7f9b907"}),{characteristic:c}=d.useBluetoothCharacteristic({uuid:"fec26ec4-6d71-4442-9f81-55bc21d658d6"}),[r,x]=y.useState(null),[m,j]=y.useState({}),C=async(b,l)=>{var M,_;if(!o.isConnected){z.show({message:"Not connected to device. Please connect via Bluetooth first.",color:"red"});return}if(!c){z.show({message:"Bluetooth characteristic not available. Please reconnect.",color:"red"});return}const w=`${b.slave_id}-${l.reg_id}`;x(w);try{const T=await new ss(c).readRegisterLive(b.slave_id,l.address,l.length,l.function_code);if(T.status==="success"&&T.data){const g=T.data,p=g.raw_values||[],S=g.timestamp||new Date().toISOString();let E;const I=g.interpretations;if(p.length>=2&&I){let R;const D=((M=l.data_type)==null?void 0:M.toLowerCase())||"uint16",H=((_=l.endianness)==null?void 0:_.toLowerCase())||"big";if(D.includes("float"))switch(H){case"big":R=I.float32_big_endian_ABCD;break;case"little":R=I.float32_little_endian_DCBA;break;case"mid_big":R=I.float32_mid_big_BADC;break;case"mid_little":R=I.float32_mid_little_CDAB;break;default:R=I.float32_big_endian_ABCD}else(D.includes("int32")||D.includes("uint32"))&&(H==="big"||H==="mid_big"?R=D.includes("uint")?I.uint32_big_endian:I.int32_big_endian:R=D.includes("uint")?I.uint32_little_endian:I.int32_little_endian);R!==void 0&&!isNaN(R)&&isFinite(R)?E=`${(R*(l.scale_factor||1)+(l.offset||0)).toFixed(4)} ${l.unit||""}`.trim():E="Invalid float value"}else p.length>0?E=`${(p[0]*(l.scale_factor||1)+(l.offset||0)).toFixed(2)} ${l.unit||""}`.trim():E="No data";j({...m,[w]:{value:E,rawValues:p,rawHex:g.raw_hex,hexValues:g.hex_values,interpretations:I,timestamp:S}}),z.show({message:`Successfully read ${l.name}: ${E}`,color:"green"})}else throw new Error(T.message||"Failed to read register")}catch(u){z.show({message:`Failed to read register: ${u.message||u}`,color:"red"}),console.error("Read register error:",u)}finally{x(null)}};return e.jsxs(F,{gap:"md",children:[s.length===0&&e.jsx(v,{c:"dimmed",ta:"center",py:"xl",children:'No Modbus slaves configured. Click "Add Slave" to get started.'}),s.map(b=>e.jsxs(Ke,{withBorder:!0,padding:"md",children:[e.jsxs(N,{justify:"space-between",mb:"xs",wrap:"wrap",children:[e.jsxs(N,{wrap:"wrap",children:[e.jsxs(v,{fw:600,size:"lg",children:["Slave ID ",b.slave_id,": ",b.name]}),e.jsx(fe,{color:b.enabled?"green":"gray",children:b.enabled?"Enabled":"Disabled"})]}),e.jsxs(N,{gap:"xs",children:[e.jsx(ae,{variant:"light",color:"blue",onClick:()=>n(b),"aria-label":"Edit slave",children:e.jsx(Re,{size:16})}),e.jsx(ae,{variant:"light",color:"red",onClick:()=>i(b.slave_id),"aria-label":"Delete slave",children:e.jsx(Ee,{size:16})})]})]}),e.jsxs(v,{size:"sm",c:"dimmed",children:[e.jsx("strong",{children:"Type:"})," ",b.device_type]}),e.jsxs(v,{size:"sm",c:"dimmed",mb:"md",children:[e.jsx("strong",{children:"Registers:"})," ",b.registers.length," configured"]}),b.registers.length>0&&e.jsx(U,{variant:"separated",children:b.registers.map((l,w)=>{var T,g,p,S,E,I;const M=`${b.slave_id}-${l.reg_id}`,_=r===M,u=m[M];return e.jsxs(U.Item,{value:`reg-${b.slave_id}-${w}`,children:[e.jsx(U.Control,{children:e.jsxs(N,{justify:"space-between",wrap:"nowrap",children:[e.jsxs("div",{children:[e.jsx(v,{size:"sm",fw:500,children:l.name}),e.jsxs(v,{size:"xs",c:"dimmed",children:["Addr: ",l.address," | FC: ",l.function_code," | Type:"," ",l.data_type]})]}),e.jsx(fe,{size:"sm",color:l.enabled?"green":"gray",children:l.enabled?"ON":"OFF"})]})}),e.jsx(U.Panel,{children:e.jsxs(F,{gap:"xs",children:[e.jsxs(f,{children:[e.jsx(f.Col,{span:6,children:e.jsxs(v,{size:"xs",c:"dimmed",children:["Register ID: ",l.reg_id]})}),e.jsx(f.Col,{span:6,children:e.jsxs(v,{size:"xs",c:"dimmed",children:["Address: ",l.address]})}),e.jsx(f.Col,{span:6,children:e.jsxs(v,{size:"xs",c:"dimmed",children:["Length: ",l.length," registers"]})}),e.jsx(f.Col,{span:6,children:e.jsxs(v,{size:"xs",c:"dimmed",children:["Function Code: ",l.function_code]})}),e.jsx(f.Col,{span:6,children:e.jsxs(v,{size:"xs",c:"dimmed",children:["Data Type: ",l.data_type]})}),e.jsx(f.Col,{span:6,children:e.jsxs(v,{size:"xs",c:"dimmed",children:["Endianness: ",l.endianness]})}),e.jsx(f.Col,{span:6,children:e.jsxs(v,{size:"xs",c:"dimmed",children:["Scale: ",l.scale_factor||1]})}),e.jsx(f.Col,{span:6,children:e.jsxs(v,{size:"xs",c:"dimmed",children:["Offset: ",l.offset||0]})}),l.unit&&e.jsx(f.Col,{span:6,children:e.jsxs(v,{size:"xs",c:"dimmed",children:["Unit: ",l.unit]})})]}),e.jsxs(N,{justify:"space-between",mt:"xs",children:[e.jsx(Qe,{label:"Read live data from this register via RS485",children:e.jsx(k,{size:"xs",variant:"light",leftSection:_?e.jsx(es,{size:14}):e.jsx(us,{size:14}),onClick:()=>C(b,l),disabled:_||!o.isConnected,children:_?"Reading...":"Read Live"})}),u&&e.jsxs(v,{size:"sm",fw:500,c:"green",children:["âœ“ ",u.value]})]}),u&&e.jsx(ve,{withBorder:!0,p:"xs",mt:"sm",bg:"gray.0",children:e.jsxs(F,{gap:"xs",children:[e.jsx(v,{size:"xs",fw:600,c:"blue",children:"ðŸ” Debug Information"}),e.jsxs(N,{gap:"xs",children:[e.jsx(v,{size:"xs",c:"dimmed",children:"Raw Values (DEC):"}),e.jsx(A,{fz:"xs",children:((T=u.rawValues)==null?void 0:T.join(", "))||"N/A"})]}),u.rawHex&&e.jsxs(N,{gap:"xs",children:[e.jsx(v,{size:"xs",c:"dimmed",children:"Raw Values (HEX):"}),e.jsx(A,{fz:"xs",c:"blue",children:u.rawHex})]}),u.hexValues&&e.jsxs(N,{gap:"xs",children:[e.jsx(v,{size:"xs",c:"dimmed",children:"Registers:"}),u.hexValues.map((R,D)=>e.jsxs(A,{fz:"xs",children:["Reg",D,": 0x",R]},D))]}),((g=u.interpretations)==null?void 0:g.raw_bytes)&&e.jsxs(N,{gap:"xs",children:[e.jsx(v,{size:"xs",c:"dimmed",children:"Raw Bytes:"}),e.jsx(A,{fz:"xs",c:"orange",children:u.interpretations.raw_bytes})]}),u.interpretations&&e.jsxs(e.Fragment,{children:[e.jsx(ge,{my:"xs",label:"Float32 Interpretations",labelPosition:"left"}),e.jsxs(h,{withTableBorder:!0,children:[e.jsx(h.Thead,{children:e.jsxs(h.Tr,{children:[e.jsx(h.Th,{children:"Format"}),e.jsx(h.Th,{children:"Value"})]})}),e.jsxs(h.Tbody,{children:[e.jsxs(h.Tr,{children:[e.jsx(h.Td,{children:e.jsx(A,{fz:"xs",children:"Big Endian (ABCD)"})}),e.jsx(h.Td,{fw:500,children:((p=u.interpretations.float32_big_endian_ABCD)==null?void 0:p.toFixed(6))??"N/A"})]}),e.jsxs(h.Tr,{children:[e.jsx(h.Td,{children:e.jsx(A,{fz:"xs",children:"Little Endian (DCBA)"})}),e.jsx(h.Td,{fw:500,children:((S=u.interpretations.float32_little_endian_DCBA)==null?void 0:S.toFixed(6))??"N/A"})]}),e.jsxs(h.Tr,{children:[e.jsx(h.Td,{children:e.jsx(A,{fz:"xs",children:"Mid-Big (BADC)"})}),e.jsx(h.Td,{fw:500,children:((E=u.interpretations.float32_mid_big_BADC)==null?void 0:E.toFixed(6))??"N/A"})]}),e.jsxs(h.Tr,{children:[e.jsx(h.Td,{children:e.jsx(A,{fz:"xs",children:"Mid-Little (CDAB)"})}),e.jsx(h.Td,{fw:500,children:((I=u.interpretations.float32_mid_little_CDAB)==null?void 0:I.toFixed(6))??"N/A"})]})]})]}),e.jsx(ge,{my:"xs",label:"Integer Interpretations",labelPosition:"left"}),e.jsxs(h,{withTableBorder:!0,children:[e.jsx(h.Thead,{children:e.jsxs(h.Tr,{children:[e.jsx(h.Th,{children:"Format"}),e.jsx(h.Th,{children:"Value"})]})}),e.jsxs(h.Tbody,{children:[e.jsxs(h.Tr,{children:[e.jsx(h.Td,{children:e.jsx(A,{fz:"xs",children:"UInt32 BE"})}),e.jsx(h.Td,{children:u.interpretations.uint32_big_endian??"N/A"})]}),e.jsxs(h.Tr,{children:[e.jsx(h.Td,{children:e.jsx(A,{fz:"xs",children:"UInt32 LE"})}),e.jsx(h.Td,{children:u.interpretations.uint32_little_endian??"N/A"})]}),e.jsxs(h.Tr,{children:[e.jsx(h.Td,{children:e.jsx(A,{fz:"xs",children:"Int32 BE"})}),e.jsx(h.Td,{children:u.interpretations.int32_big_endian??"N/A"})]}),e.jsxs(h.Tr,{children:[e.jsx(h.Td,{children:e.jsx(A,{fz:"xs",children:"Int32 LE"})}),e.jsx(h.Td,{children:u.interpretations.int32_little_endian??"N/A"})]}),e.jsxs(h.Tr,{children:[e.jsx(h.Td,{children:e.jsx(A,{fz:"xs",children:"UInt16 Reg0"})}),e.jsx(h.Td,{children:u.interpretations.uint16_reg0??"N/A"})]}),e.jsxs(h.Tr,{children:[e.jsx(h.Td,{children:e.jsx(A,{fz:"xs",children:"UInt16 Reg1"})}),e.jsx(h.Td,{children:u.interpretations.uint16_reg1??"N/A"})]}),e.jsxs(h.Tr,{children:[e.jsx(h.Td,{children:e.jsx(A,{fz:"xs",children:"Int16 Reg0"})}),e.jsx(h.Td,{children:u.interpretations.int16_reg0??"N/A"})]}),e.jsxs(h.Tr,{children:[e.jsx(h.Td,{children:e.jsx(A,{fz:"xs",children:"Int16 Reg1"})}),e.jsx(h.Td,{children:u.interpretations.int16_reg1??"N/A"})]})]})]})]}),e.jsxs(v,{size:"xs",c:"dimmed",children:["Read at: ",new Date(u.timestamp).toLocaleString()]})]})})]})})]},w)})}),b.registers.length===0&&e.jsx(v,{size:"sm",c:"dimmed",ta:"center",py:"md",children:"No registers configured for this slave"})]},b.slave_id)),e.jsx(k,{leftSection:e.jsx(Ne,{size:16}),onClick:a,fullWidth:!0,children:"Add Slave Device"})]})},$s=({opened:s,onClose:n,onSave:i,slave:a,existingSlaveIds:o})=>{const d=!!a,[c,r]=y.useState(!1),[x,m]=y.useState(1),[j,C]=y.useState(""),[b,l]=y.useState(""),[w,M]=y.useState(!0),[_,u]=y.useState([]),[T,g]=y.useState(null),[p,S]=y.useState({});y.useEffect(()=>{a?(m(a.slave_id),C(a.name),l(a.device_type),M(a.enabled),u(a.registers||[])):(m(1),C(""),l(""),M(!0),u([])),g(null),S({})},[a,s]);const E=()=>{if(_.length>=B.MAX_REGISTERS_PER_SLAVE){z.show({message:`Maximum ${B.MAX_REGISTERS_PER_SLAVE} registers per slave allowed`,color:"orange"});return}g(-1),S({reg_id:"",name:"",enabled:!0,address:0,length:1,function_code:3,data_type:"uint16",endianness:"big",scale_factor:1,offset:0,unit:""})},I=t=>{g(t),S({..._[t]})},R=()=>{if(!p.reg_id||!p.name){z.show({message:"Register ID and Name are required",color:"red"});return}if(_.some((q,ue)=>q.reg_id===p.reg_id&&ue!==T)){z.show({message:"Register ID must be unique",color:"red"});return}const O=p;if(T===-1)u([..._,O]);else if(T!==null){const q=[..._];q[T]=O,u(q)}g(null),S({})},D=t=>{window.confirm(`Delete register "${_[t].name}"?`)&&u(_.filter((q,ue)=>ue!==t))},H=()=>{g(null),S({})},se=async()=>{if(!j.trim()){z.show({message:"Slave name is required",color:"red"});return}if(x<B.SLAVE_ID_MIN||x>B.SLAVE_ID_MAX){z.show({message:`Slave ID must be between ${B.SLAVE_ID_MIN} and ${B.SLAVE_ID_MAX}`,color:"red"});return}if((!d||a.slave_id!==x)&&o.includes(x)){z.show({message:`Slave ID ${x} is already in use`,color:"red"});return}if(!(_.length===0&&!window.confirm("No registers configured. Do you want to save anyway?"))){r(!0);try{const t={slave_id:x,name:j.trim(),device_type:b.trim(),enabled:w,registers:_};await i(t),z.show({message:`Slave ${d?"updated":"added"} successfully`,color:"green"}),n()}catch{}finally{r(!1)}}};return e.jsx(P,{opened:s,onClose:n,title:e.jsx(v,{size:"lg",fw:600,children:d?"Edit Modbus Slave":"Add Modbus Slave"}),size:"xl",closeOnClickOutside:!1,children:e.jsxs(F,{gap:"md",children:[e.jsxs(f,{children:[e.jsx(f.Col,{span:{base:12,sm:6},children:e.jsx(X,{label:"Slave ID",value:x,onChange:t=>m(Number(t)),min:B.SLAVE_ID_MIN,max:B.SLAVE_ID_MAX,required:!0,disabled:d,description:d?"Slave ID cannot be changed":"1-247"})}),e.jsx(f.Col,{span:{base:12,sm:6},children:e.jsx(Q,{label:"Slave Name",value:j,onChange:t=>C(t.currentTarget.value),required:!0,placeholder:"e.g., Energy Meter"})}),e.jsx(f.Col,{span:{base:12,sm:6},children:e.jsx(Q,{label:"Device Type",value:b,onChange:t=>l(t.currentTarget.value),placeholder:"e.g., energy_meter"})}),e.jsx(f.Col,{span:12,children:e.jsx(me,{label:"Enabled",checked:w,onChange:t=>M(t.currentTarget.checked),description:"Enable/disable polling for this slave"})})]}),e.jsx(ge,{label:"Registers Configuration",labelPosition:"center"}),e.jsxs(F,{gap:"xs",children:[e.jsxs(N,{justify:"space-between",children:[e.jsxs(v,{size:"sm",fw:500,children:["Configured Registers (",_.length,"/",B.MAX_REGISTERS_PER_SLAVE,")"]}),e.jsx(k,{leftSection:e.jsx(Ne,{size:16}),onClick:E,size:"xs",disabled:T!==null||_.length>=B.MAX_REGISTERS_PER_SLAVE,children:"Add Register"})]}),T!==null&&e.jsxs(F,{gap:"xs",p:"md",style:{border:"1px solid var(--mantine-color-blue-4)",borderRadius:"var(--mantine-radius-md)",backgroundColor:"var(--mantine-color-blue-0)"},children:[e.jsx(v,{size:"sm",fw:600,c:"blue",children:T===-1?"New Register":"Edit Register"}),e.jsxs(f,{children:[e.jsx(f.Col,{span:{base:12,sm:6},children:e.jsx(Q,{label:"Register ID",value:p.reg_id||"",onChange:t=>S({...p,reg_id:t.currentTarget.value}),required:!0,placeholder:"e.g., voltage_l1"})}),e.jsx(f.Col,{span:{base:12,sm:6},children:e.jsx(Q,{label:"Name",value:p.name||"",onChange:t=>S({...p,name:t.currentTarget.value}),required:!0,placeholder:"e.g., Voltage L1"})}),e.jsx(f.Col,{span:{base:12,sm:4},children:e.jsx(X,{label:"Address",value:p.address||0,onChange:t=>S({...p,address:Number(t)}),min:B.REGISTER_ADDRESS_MIN,max:B.REGISTER_ADDRESS_MAX})}),e.jsx(f.Col,{span:{base:12,sm:4},children:e.jsx(X,{label:"Length",value:p.length||1,onChange:t=>S({...p,length:Number(t)}),min:B.REGISTER_LENGTH_MIN,max:B.REGISTER_LENGTH_MAX})}),e.jsx(f.Col,{span:{base:12,sm:4},children:e.jsx(Z,{label:"Function Code",value:String(p.function_code||3),onChange:t=>S({...p,function_code:Number(t)}),data:os.map(t=>({value:String(t.value),label:t.label}))})}),e.jsx(f.Col,{span:{base:12,sm:6},children:e.jsx(Z,{label:"Data Type",value:p.data_type||"uint16",onChange:t=>S({...p,data_type:t}),data:ds.map(t=>({value:t.value,label:t.label}))})}),e.jsx(f.Col,{span:{base:12,sm:6},children:e.jsx(Z,{label:"Endianness",value:p.endianness||"big",onChange:t=>S({...p,endianness:t}),data:cs.map(t=>({value:t.value,label:t.label}))})}),e.jsx(f.Col,{span:{base:12,sm:4},children:e.jsx(X,{label:"Scale Factor",value:p.scale_factor||1,onChange:t=>S({...p,scale_factor:Number(t)}),step:.1,decimalScale:4})}),e.jsx(f.Col,{span:{base:12,sm:4},children:e.jsx(X,{label:"Offset",value:p.offset||0,onChange:t=>S({...p,offset:Number(t)}),step:.1,decimalScale:4})}),e.jsx(f.Col,{span:{base:12,sm:4},children:e.jsx(Q,{label:"Unit",value:p.unit||"",onChange:t=>S({...p,unit:t.currentTarget.value}),placeholder:"e.g., V, A, W"})}),e.jsx(f.Col,{span:12,children:e.jsx(me,{label:"Enabled",checked:p.enabled!==!1,onChange:t=>S({...p,enabled:t.currentTarget.checked})})})]}),e.jsxs(N,{justify:"flex-end",gap:"xs",children:[e.jsx(k,{variant:"light",onClick:H,size:"xs",children:"Cancel"}),e.jsxs(k,{onClick:R,size:"xs",children:[T===-1?"Add":"Update"," Register"]})]})]}),_.length>0&&e.jsx(U,{variant:"contained",children:_.map((t,O)=>e.jsxs(U.Item,{value:`reg-${O}`,children:[e.jsx(U.Control,{children:e.jsx(N,{justify:"space-between",wrap:"nowrap",children:e.jsxs("div",{children:[e.jsx(v,{size:"sm",fw:500,children:t.name}),e.jsxs(v,{size:"xs",c:"dimmed",children:["ID: ",t.reg_id," | Addr: ",t.address," | FC: ",t.function_code," |"," ",t.data_type]})]})})}),e.jsx(U.Panel,{children:e.jsxs(F,{gap:"xs",children:[e.jsxs(f,{children:[e.jsx(f.Col,{span:6,children:e.jsxs(v,{size:"xs",c:"dimmed",children:["Address: ",t.address]})}),e.jsx(f.Col,{span:6,children:e.jsxs(v,{size:"xs",c:"dimmed",children:["Length: ",t.length]})}),e.jsx(f.Col,{span:6,children:e.jsxs(v,{size:"xs",c:"dimmed",children:["Function Code: ",t.function_code]})}),e.jsx(f.Col,{span:6,children:e.jsxs(v,{size:"xs",c:"dimmed",children:["Data Type: ",t.data_type]})}),e.jsx(f.Col,{span:6,children:e.jsxs(v,{size:"xs",c:"dimmed",children:["Scale: ",t.scale_factor||1]})}),e.jsx(f.Col,{span:6,children:e.jsxs(v,{size:"xs",c:"dimmed",children:["Offset: ",t.offset||0]})}),e.jsx(f.Col,{span:6,children:e.jsxs(v,{size:"xs",c:"dimmed",children:["Unit: ",t.unit||"N/A"]})}),e.jsx(f.Col,{span:6,children:e.jsxs(v,{size:"xs",c:"dimmed",children:["Enabled: ",t.enabled?"Yes":"No"]})})]}),e.jsxs(N,{gap:"xs",children:[e.jsx(ae,{variant:"light",color:"blue",onClick:()=>I(O),disabled:T!==null,children:e.jsx(Re,{size:16})}),e.jsx(ae,{variant:"light",color:"red",onClick:()=>D(O),disabled:T!==null,children:e.jsx(Ee,{size:16})})]})]})})]},O))}),_.length===0&&T===null&&e.jsx(v,{size:"sm",c:"dimmed",ta:"center",py:"md",children:'No registers configured. Click "Add Register" to add one.'})]}),e.jsxs(N,{justify:"flex-end",mt:"md",children:[e.jsx(k,{variant:"light",onClick:n,disabled:c,children:"Cancel"}),e.jsxs(k,{onClick:se,loading:c,children:[d?"Update":"Add"," Slave"]})]})]})})},Ks=()=>{const s=hs(),[n,i]=y.useState(null),[a,o]=y.useState(!1),[d,c]=y.useState(null),[r,x]=y.useState(!1),[m,j]=y.useState(!1);y.useEffect(()=>{s.modbusConfig&&(i(s.modbusConfig),s.modbusConfig.read_paused!==void 0&&x(s.modbusConfig.read_paused))},[s.modbusConfig]);const C=async()=>{if(!n){z.show({message:"No configuration to save",color:"red"});return}try{await s.saveModbusConfig({uart_config:n.uart_config,retry_count:n.retry_count})}catch{}},b=async g=>{if(window.confirm(`Are you sure you want to delete Slave ID ${g}? This action cannot be undone.`))try{await s.deleteSlave(g)}catch{}},l=g=>{c(g),o(!0)},w=()=>{c(null),o(!0)},M=()=>{o(!1),c(null)},_=async g=>{j(!0);try{await s.pauseModbusRead(g),x(g),z.show({message:g?"Modbus reading paused":"Modbus reading resumed",color:g?"orange":"green"})}catch{}finally{j(!1)}},u=async g=>{if(g)try{const p=await g.text(),S=JSON.parse(p),E=S.modbus_config||S;if(!E.uart_config){z.show({message:"Invalid configuration file: missing uart_config",color:"red"});return}await s.importModbusConfig(E)}catch(p){z.show({message:`Failed to import: ${p instanceof Error?p.message:"Invalid JSON file"}`,color:"red"})}},T=async g=>{d?await s.updateSlave(g.slave_id,g):await s.addSlave(g),await s.loadModbusConfig()};return e.jsxs(F,{gap:"md",children:[e.jsxs(N,{justify:"space-between",wrap:"wrap",children:[e.jsx(v,{size:"xl",fw:700,children:"Modbus Configuration"}),e.jsxs(N,{wrap:"wrap",children:[e.jsx(k,{variant:"light",leftSection:e.jsx(xs,{size:16}),onClick:()=>s.loadModbusConfig(),loading:s.isLoading,children:"Get Config"}),e.jsx(k,{variant:"light",color:"teal",leftSection:e.jsx(Ps,{size:16}),onClick:()=>s.exportModbusConfig(),disabled:!n,children:"Export"}),e.jsx(we,{onChange:u,accept:"application/json,.json",children:g=>e.jsx(k,{variant:"light",color:"orange",leftSection:e.jsx(ms,{size:16}),loading:s.isLoading,...g,children:"Import"})})]})]}),!n&&!s.isLoading&&e.jsx(v,{c:"dimmed",ta:"center",py:"xl",children:'Click "Get Config" to load current Modbus configuration'}),n&&e.jsxs(e.Fragment,{children:[e.jsx(he,{title:"Modbus Polling Control",icon:r?e.jsx(Os,{size:20,color:"var(--mantine-color-orange-6)"}):e.jsx(as,{size:20,color:"var(--mantine-color-green-6)"}),children:e.jsxs(N,{align:"center",gap:"md",children:[e.jsx(me,{size:"lg",color:r?"orange":"green",checked:r,onChange:g=>_(g.currentTarget.checked),disabled:m,label:"Pause Modbus Read",description:"Temporarily stops data collection polling so BLE commands and live reads respond faster"}),e.jsx(fe,{color:r?"orange":"green",size:"lg",variant:"light",children:r?"Polling Paused":"Polling Active"})]})}),e.jsxs(he,{title:"UART Configuration",icon:e.jsx(ns,{size:20}),children:[e.jsx(Fs,{config:n.uart_config,onChange:g=>i({...n,uart_config:g})}),e.jsx(f,{mt:"md",children:e.jsx(f.Col,{span:12,children:e.jsx(X,{label:"Retry Count",value:n.retry_count,onChange:g=>i({...n,retry_count:Number(g)}),min:1,max:10,description:"Number of retries on communication failure"})})}),e.jsx(N,{justify:"flex-end",mt:"md",children:e.jsx(k,{onClick:C,loading:s.isLoading,children:"Save UART Config"})})]}),e.jsx(he,{title:"Modbus Slave Devices",icon:e.jsx(ks,{size:20}),children:e.jsx(Ls,{slaves:n.slaves||[],onEdit:l,onDelete:b,onAdd:w})})]}),e.jsx($s,{opened:a,onClose:M,onSave:T,slave:d,existingSlaveIds:((n==null?void 0:n.slaves)||[]).map(g=>g.slave_id)})]})};export{Ks as default};
