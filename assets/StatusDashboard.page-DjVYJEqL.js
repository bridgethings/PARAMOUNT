import{s as Q,w as m,j as e,S as se,x as o,T as r,y as R,G as g,Q as v,z as ie,A as f}from"./index-VfOoqpvz.js";import{C as y}from"./ConfigCard-LwjiY8Dg.js";import{u as ne}from"./useConfiguration-CS34jahr.js";import{I as D,B as h}from"./IconRefresh-5nSooA6e.js";import{a as re,I as te}from"./IconDeviceDesktop-C0XcMkhT.js";import{I as ae}from"./IconWifi-CqasLKmU.js";import{I as ce}from"./IconDeviceMobile-DZ6HCduD.js";import{P as de}from"./Progress-DuIidT7G.js";import{A as S,T as a}from"./Table-CBfE6jdr.js";/**
 * @license @tabler/icons-react v3.29.0 - MIT
 *
 * This source code is licensed under the MIT license.
 * See the LICENSE file in the root directory of this source tree.
 */var F=Q("outline","cell-signal-4","IconCellSignal4",[["path",{d:"M20 20h-15.269a.731 .731 0 0 1 -.517 -1.249l14.537 -14.537a.731 .731 0 0 1 1.249 .517v15.269z",key:"svg-0"}],["path",{d:"M16 7v13",key:"svg-1"}]]);/**
 * @license @tabler/icons-react v3.29.0 - MIT
 *
 * This source code is licensed under the MIT license.
 * See the LICENSE file in the root directory of this source tree.
 */var L=Q("outline","circle","IconCircle",[["path",{d:"M12 12m-9 0a9 9 0 1 0 18 0a9 9 0 1 0 -18 0",key:"svg-0"}]]);function le(i){const s=i==null?void 0:i.values;if(!s||typeof s!="object"||Array.isArray(s))return[];const I=(i==null?void 0:i.units)||{};return Object.keys(s).map(l=>({name:l,value:s[l],unit:I[l]||""}))}function oe(i){return i==null?"—":typeof i=="number"?Number.isInteger(i)?i.toString():i.toFixed(3):String(i)}function me(i){return i?new Date(i*1e3).toLocaleString():"Never"}function he(i,s){return s===void 0?0:i==="wifi"?Math.max(0,Math.min(100,Math.round((s+100)/70*100))):i==="modem"?Math.max(0,Math.min(100,Math.round(s/31*100))):s}function V(i){return i>=66?"green":i>=33?"yellow":"red"}function ue(i){return i.charAt(0).toUpperCase()+i.slice(1)}const Se=()=>{var O,W;const i=ne(),[s,I]=m.useState(null),[l,M]=m.useState(null),[p,T]=m.useState(null),[_,N]=m.useState(!1),[B,P]=m.useState(!1),[G,A]=m.useState(!1),c=m.useRef(!1),q=async()=>{if(!c.current){c.current=!0,N(!0);try{const n=await i.getDeviceStatus();I(n),M(null),T(null)}catch(n){f.show({message:`Get status failed: ${n instanceof Error?n.message:"Unknown error"}`,color:"red"})}finally{N(!1),c.current=!1}}},J=async()=>{if(!c.current){c.current=!0,P(!0);try{const n=await i.liveReadModbus();M(n),f.show({message:"Live Modbus read complete",color:"green"})}catch(n){f.show({message:`Live read failed: ${n instanceof Error?n.message:"Unknown error"}`,color:"red"})}finally{P(!1),c.current=!1}}},K=async()=>{if(!c.current){c.current=!0,A(!0);try{const n=await i.liveReadDI();T(n),f.show({message:"Live DI read complete",color:"green"})}catch(n){f.show({message:`Live DI read failed: ${n instanceof Error?n.message:"Unknown error"}`,color:"red"})}finally{A(!1),c.current=!1}}},t=s==null?void 0:s.network,d=(t==null?void 0:t.type)||"none",k=d!=="none",X=(t==null?void 0:t.ip_address)||"—",C=he(d,t==null?void 0:t.signal_strength),Y=(t==null?void 0:t.signal_label)||"—",E=(l==null?void 0:l.results)||(s==null?void 0:s.modbus)||[],U=l?"live":s!=null&&s.modbus?"cached":"none",H=(p==null?void 0:p.inputs)||(s==null?void 0:s.digital_inputs)||[],$=p?"live":s!=null&&s.digital_inputs?"cached":"none",w=_||B||G;return e.jsxs(se,{gap:"md",children:[e.jsxs(o,{justify:"space-between",align:"center",children:[e.jsx(r,{size:"sm",c:"dimmed",children:s?"Status loaded":'Press "Get Status" to load device data'}),e.jsx(R,{size:"sm",variant:"outline",leftSection:e.jsx(D,{size:14}),loading:_,disabled:w,onClick:q,children:"Get Status"})]}),e.jsx(y,{title:"Device Time",icon:e.jsx(re,{size:20}),children:e.jsxs(o,{gap:"lg",align:"center",children:[e.jsx(r,{size:"xl",fw:600,ff:"monospace",children:(O=s==null?void 0:s.time)!=null&&O.rtc_initialized&&s.time.datetime||"—"}),s?(W=s.time)!=null&&W.rtc_initialized?e.jsx(h,{color:"green",variant:"light",children:"Initialized"}):e.jsx(h,{color:"gray",variant:"light",children:"Not Initialized"}):null]})}),e.jsx(y,{title:"Network",icon:e.jsx(ie,{size:20}),children:e.jsxs(g,{children:[e.jsx(g.Col,{span:{base:12,sm:4},children:e.jsxs(v,{p:"md",radius:"md",withBorder:!0,children:[e.jsx(r,{size:"sm",c:"dimmed",mb:"xs",children:"Connection"}),e.jsxs(o,{gap:"xs",align:"center",children:[d==="wifi"&&e.jsx(ae,{size:18,color:"green"}),d==="ethernet"&&e.jsx(te,{size:18,color:"green"}),d==="modem"&&e.jsx(ce,{size:18,color:"green"}),d==="none"&&e.jsx(L,{size:18,color:"gray"}),e.jsx(h,{color:k?"green":"gray",variant:"light",size:"lg",children:ue(d)})]})]})}),e.jsx(g.Col,{span:{base:12,sm:4},children:e.jsxs(v,{p:"md",radius:"md",withBorder:!0,children:[e.jsx(r,{size:"sm",c:"dimmed",mb:"xs",children:"IP Address"}),e.jsx(r,{size:"md",fw:500,ff:"monospace",children:X})]})}),e.jsx(g.Col,{span:{base:12,sm:4},children:e.jsxs(v,{p:"md",radius:"md",withBorder:!0,children:[e.jsx(r,{size:"sm",c:"dimmed",mb:"xs",children:"Signal Strength"}),k?e.jsxs(e.Fragment,{children:[e.jsxs(o,{gap:"xs",align:"center",mb:4,children:[e.jsx(F,{size:16,color:V(C)}),e.jsx(r,{size:"sm",fw:500,children:Y}),d==="wifi"&&e.jsxs(r,{size:"xs",c:"dimmed",children:["(",t==null?void 0:t.signal_strength," dBm)"]}),d==="modem"&&e.jsxs(r,{size:"xs",c:"dimmed",children:["(",t==null?void 0:t.signal_strength,"/31)"]})]}),e.jsx(de,{value:C,color:V(C),size:"sm",radius:"xs"})]}):e.jsx(r,{size:"sm",c:"dimmed",children:"—"})]})})]})}),e.jsxs(y,{title:"Modbus Sensor Data",icon:e.jsx(F,{size:20}),children:[e.jsxs(o,{justify:"space-between",mb:"md",children:[e.jsx(r,{size:"sm",c:"dimmed",children:U==="live"?"Live read data":U==="cached"?"Cached data":"No data — press Live Read"}),e.jsx(R,{size:"xs",variant:"outline",leftSection:e.jsx(D,{size:14}),loading:B,disabled:w,onClick:J,children:"Live Read"})]}),E.length===0?e.jsx(r,{size:"sm",c:"dimmed",ta:"center",py:"lg",children:"No Modbus slaves configured"}):e.jsx(S,{children:E.map((n,u)=>{const x=n.slave_id??u+1,Z=n.name||`Slave ${x}`,j=le(n),z=n.status||"unknown";return e.jsxs(S.Item,{value:String(x),children:[e.jsx(S.Control,{children:e.jsxs(o,{gap:"sm",align:"center",children:[e.jsx(r,{size:"sm",fw:600,children:Z}),e.jsxs(h,{size:"xs",variant:"light",color:"blue",children:["ID ",x]}),e.jsx(h,{size:"xs",variant:"light",color:z==="ok"?"green":z==="pending"?"yellow":"red",children:z}),j.length>0&&e.jsxs(h,{size:"xs",variant:"light",color:"gray",children:[j.length," reg",j.length!==1?"s":""]}),n.last_read_time&&e.jsx(r,{size:"xs",c:"dimmed",children:me(n.last_read_time)})]})}),e.jsx(S.Panel,{children:j.length===0?e.jsx(r,{size:"sm",c:"dimmed",py:"xs",children:z==="pending"?"No data yet — press Live Read":"No registers read"}):e.jsx(a.ScrollContainer,{minWidth:300,children:e.jsxs(a,{withTableBorder:!0,highlightOnHover:!0,children:[e.jsx(a.Thead,{children:e.jsxs(a.Tr,{children:[e.jsx(a.Th,{children:"Register"}),e.jsx(a.Th,{children:"Value"}),e.jsx(a.Th,{children:"Unit"})]})}),e.jsx(a.Tbody,{children:j.map((b,ee)=>e.jsxs(a.Tr,{children:[e.jsx(a.Td,{children:e.jsx(r,{size:"sm",children:b.name})}),e.jsx(a.Td,{children:e.jsx(r,{size:"sm",fw:500,ff:"monospace",children:oe(b.value)})}),e.jsx(a.Td,{children:e.jsx(r,{size:"sm",c:"dimmed",children:b.unit||"—"})})]},b.name||ee))})]})})})]},x)})})]}),e.jsxs(y,{title:"Digital Inputs",icon:e.jsx(L,{size:20}),children:[e.jsxs(o,{justify:"space-between",mb:"md",children:[e.jsx(r,{size:"sm",c:"dimmed",children:$==="live"?"Live read data":$==="cached"?"Cached data":"No data — press Live Read"}),e.jsx(R,{size:"xs",variant:"outline",leftSection:e.jsx(D,{size:14}),loading:G,disabled:w,onClick:K,children:"Live Read"})]}),H.length>0?e.jsx(g,{children:H.map(n=>{const u=n.state===1||n.state===!0,x=n.name||n.id||"DI";return e.jsx(g.Col,{span:{base:6,sm:3},children:e.jsxs(v,{p:"md",radius:"md",withBorder:!0,ta:"center",children:[e.jsx(r,{size:"xs",c:"dimmed",mb:4,children:x}),e.jsxs(o,{justify:"center",gap:"xs",align:"center",children:[e.jsx(L,{size:14,color:u?"green":"gray",fill:u?"green":"gray"}),e.jsx(h,{color:u?"green":"gray",variant:"light",children:u?"HIGH":"LOW"})]})]})},n.id)})}):e.jsx(r,{size:"sm",c:"dimmed",ta:"center",py:"lg",children:"No digital input data — press Live Read"})]})]})};export{Se as default};
