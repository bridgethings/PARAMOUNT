import{C as Ae,w,D as ss,e as ts,E as ns,F as as,j as e,O as ls,R as rs,B as ce,H as is,J as ds,K as xe,L as de,M as os,N as Ee,P as cs,Q as se,V as us,u as W,W as hs,X as xs,f as ne,r as Be,a as gs,d as ms,n as fs,g as ps,c as js,s as re,S as q,G as y,v as le,Y as bs,Z as vs,T as _,_ as _s,x as B,$ as te,a0 as ys,y as V,a1 as Cs,A as I,a2 as ws,t as pe,a3 as Ss,a4 as Ts}from"./index-VfOoqpvz.js";import{I as De,a as Pe,C as Me}from"./ConfigCard-LwjiY8Dg.js";import{B as Ms,D as Bs,P as ks,S as zs,V as ie,F as Ns,a as Is,E as Rs}from"./configOptions-iEDegn7H.js";import{N as X,C as $,D as ke}from"./NumberInput-D5MSRe9S.js";import{B as Z,I as As}from"./IconRefresh-5nSooA6e.js";import{A as fe,T as h}from"./Table-CBfE6jdr.js";import{T as ae}from"./TextInput-C2YCo21m.js";import{u as Es}from"./useConfiguration-CS34jahr.js";import{I as Ds}from"./IconDownload-BEf9TNFi.js";import{I as Ps}from"./IconUpload-C8zg8ZgW.js";const[Fs,J]=Ae("ModalBase component was not found in tree");function Os({opened:s,transitionDuration:a}){const[l,t]=w.useState(s),d=w.useRef(-1),c=ss()?0:a;return w.useEffect(()=>(s?(t(!0),window.clearTimeout(d.current)):c===0?t(!1):d.current=window.setTimeout(()=>t(!1),c),()=>window.clearTimeout(d.current)),[s,c]),l}function $s({id:s,transitionProps:a,opened:l,trapFocus:t,closeOnEscape:d,onClose:o,returnFocus:c}){const i=ts(s),[x,m]=w.useState(!1),[C,z]=w.useState(!1),R=typeof(a==null?void 0:a.duration)=="number"?a==null?void 0:a.duration:200,T=Os({opened:l,transitionDuration:R});return ns("keydown",F=>{var A;F.key==="Escape"&&d&&l&&((A=F.target)==null?void 0:A.getAttribute("data-mantine-stop-propagation"))!=="true"&&o()},{capture:!0}),as({opened:l,shouldReturnFocus:t&&c}),{_id:i,titleMounted:x,bodyMounted:C,shouldLockScroll:T,setTitleMounted:m,setBodyMounted:z}}const Fe=w.forwardRef(({keepMounted:s,opened:a,onClose:l,id:t,transitionProps:d,onExitTransitionEnd:o,onEnterTransitionEnd:c,trapFocus:i,closeOnEscape:x,returnFocus:m,closeOnClickOutside:C,withinPortal:z,portalProps:R,lockScroll:T,children:F,zIndex:A,shadow:r,padding:p,__vars:S,unstyled:b,removeScrollProps:f,...N},v)=>{const{_id:L,titleMounted:g,bodyMounted:k,shouldLockScroll:M,setTitleMounted:O,setBodyMounted:D}=$s({id:t,transitionProps:d,opened:a,trapFocus:i,closeOnEscape:x,onClose:l,returnFocus:m}),{key:E,...U}=f||{};return e.jsx(ls,{...R,withinPortal:z,children:e.jsx(Fs,{value:{opened:a,onClose:l,closeOnClickOutside:C,onExitTransitionEnd:o,onEnterTransitionEnd:c,transitionProps:{...d,keepMounted:s},getTitleId:()=>`${L}-title`,getBodyId:()=>`${L}-body`,titleMounted:g,bodyMounted:k,setTitleMounted:O,setBodyMounted:D,trapFocus:i,closeOnEscape:x,zIndex:A,unstyled:b},children:e.jsx(rs,{enabled:M&&T,...U,children:e.jsx(ce,{ref:v,...N,__vars:{...S,"--mb-z-index":(A||xe("modal")).toString(),"--mb-shadow":ds(r),"--mb-padding":is(p)},children:F})},E)})})});Fe.displayName="@mantine/core/ModalBase";function Ls(){const s=J();return w.useEffect(()=>(s.setBodyMounted(!0),()=>s.setBodyMounted(!1)),[]),s.getBodyId()}var oe={title:"m_615af6c9",header:"m_b5489c3c",inner:"m_60c222c7",content:"m_fd1ab0aa",close:"m_606cb269",body:"m_5df29311"};const Oe=w.forwardRef(({className:s,...a},l)=>{const t=Ls(),d=J();return e.jsx(ce,{ref:l,...a,id:t,className:de({[oe.body]:!d.unstyled},s)})});Oe.displayName="@mantine/core/ModalBaseBody";const $e=w.forwardRef(({className:s,onClick:a,...l},t)=>{const d=J();return e.jsx(os,{ref:t,...l,onClick:o=>{d.onClose(),a==null||a(o)},className:de({[oe.close]:!d.unstyled},s),unstyled:d.unstyled})});$e.displayName="@mantine/core/ModalBaseCloseButton";const Le=w.forwardRef(({transitionProps:s,className:a,innerProps:l,onKeyDown:t,style:d,...o},c)=>{const i=J();return e.jsx(Ee,{mounted:i.opened,transition:"pop",...i.transitionProps,onExited:()=>{var x,m,C;(x=i.onExitTransitionEnd)==null||x.call(i),(C=(m=i.transitionProps)==null?void 0:m.onExited)==null||C.call(m)},onEntered:()=>{var x,m,C;(x=i.onEnterTransitionEnd)==null||x.call(i),(C=(m=i.transitionProps)==null?void 0:m.onEntered)==null||C.call(m)},...s,children:x=>e.jsx("div",{...l,className:de({[oe.inner]:!i.unstyled},l.className),children:e.jsx(cs,{active:i.opened&&i.trapFocus,innerRef:c,children:e.jsx(se,{...o,component:"section",role:"dialog",tabIndex:-1,"aria-modal":!0,"aria-describedby":i.bodyMounted?i.getBodyId():void 0,"aria-labelledby":i.titleMounted?i.getTitleId():void 0,style:[d,x],className:de({[oe.content]:!i.unstyled},a),unstyled:i.unstyled,children:o.children})})})})});Le.displayName="@mantine/core/ModalBaseContent";const Ve=w.forwardRef(({className:s,...a},l)=>{const t=J();return e.jsx(ce,{component:"header",ref:l,className:de({[oe.header]:!t.unstyled},s),...a})});Ve.displayName="@mantine/core/ModalBaseHeader";const Vs={duration:200,timingFunction:"ease",transition:"fade"};function Us(s){const a=J();return{...Vs,...a.transitionProps,...s}}const Ue=w.forwardRef(({onClick:s,transitionProps:a,style:l,visible:t,...d},o)=>{const c=J(),i=Us(a);return e.jsx(Ee,{mounted:t!==void 0?t:c.opened,...i,transition:"fade",children:x=>e.jsx(us,{ref:o,fixed:!0,style:[l,x],zIndex:c.zIndex,unstyled:c.unstyled,onClick:m=>{s==null||s(m),c.closeOnClickOutside&&c.onClose()},...d})})});Ue.displayName="@mantine/core/ModalBaseOverlay";function qs(){const s=J();return w.useEffect(()=>(s.setTitleMounted(!0),()=>s.setTitleMounted(!1)),[]),s.getTitleId()}const qe=w.forwardRef(({className:s,...a},l)=>{const t=qs(),d=J();return e.jsx(ce,{component:"h2",ref:l,className:de({[oe.title]:!d.unstyled},s),...a,id:t})});qe.displayName="@mantine/core/ModalBaseTitle";function Hs({children:s}){return e.jsx(e.Fragment,{children:s})}const Gs={multiple:!1},He=w.forwardRef((s,a)=>{const{onChange:l,children:t,multiple:d,accept:o,name:c,form:i,resetRef:x,disabled:m,capture:C,inputProps:z,...R}=W("FileButton",Gs,s),T=w.useRef(null),F=()=>{var p;!m&&((p=T.current)==null||p.click())},A=p=>{l(d?Array.from(p.currentTarget.files):p.currentTarget.files[0]||null)};return hs(x,()=>{T.current&&(T.current.value="")}),e.jsxs(e.Fragment,{children:[t({onClick:F,...R}),e.jsx("input",{style:{display:"none"},type:"file",accept:o,multiple:d,onChange:A,ref:xs(a,T),name:c,form:i,capture:C,...z})]})});He.displayName="@mantine/core/FileButton";const[Zs,ue]=Ae("Modal component was not found in tree");var Y={root:"m_9df02822",content:"m_54c44539",inner:"m_1f958f16",header:"m_d0e2b9cd"};const Ks={},je=ne((s,a)=>{const l=W("ModalBody",Ks,s),{classNames:t,className:d,style:o,styles:c,vars:i,...x}=l,m=ue();return e.jsx(Oe,{ref:a,...m.getStyles("body",{classNames:t,style:o,styles:c,className:d}),...x})});je.classes=Y;je.displayName="@mantine/core/ModalBody";const Xs={},be=ne((s,a)=>{const l=W("ModalCloseButton",Xs,s),{classNames:t,className:d,style:o,styles:c,vars:i,...x}=l,m=ue();return e.jsx($e,{ref:a,...m.getStyles("close",{classNames:t,style:o,styles:c,className:d}),...x})});be.classes=Y;be.displayName="@mantine/core/ModalCloseButton";const Ws={},ve=ne((s,a)=>{const l=W("ModalContent",Ws,s),{classNames:t,className:d,style:o,styles:c,vars:i,children:x,__hidden:m,...C}=l,z=ue(),R=z.scrollAreaComponent||Hs;return e.jsx(Le,{...z.getStyles("content",{className:d,style:o,styles:c,classNames:t}),innerProps:z.getStyles("inner",{className:d,style:o,styles:c,classNames:t}),"data-full-screen":z.fullScreen||void 0,"data-modal-content":!0,"data-hidden":m||void 0,ref:a,...C,children:e.jsx(R,{style:{maxHeight:z.fullScreen?"100dvh":`calc(100dvh - (${Be(z.yOffset)} * 2))`},children:x})})});ve.classes=Y;ve.displayName="@mantine/core/ModalContent";const Js={},_e=ne((s,a)=>{const l=W("ModalHeader",Js,s),{classNames:t,className:d,style:o,styles:c,vars:i,...x}=l,m=ue();return e.jsx(Ve,{ref:a,...m.getStyles("header",{classNames:t,style:o,styles:c,className:d}),...x})});_e.classes=Y;_e.displayName="@mantine/core/ModalHeader";const Ys={},ye=ne((s,a)=>{const l=W("ModalOverlay",Ys,s),{classNames:t,className:d,style:o,styles:c,vars:i,...x}=l,m=ue();return e.jsx(Ue,{ref:a,...m.getStyles("overlay",{classNames:t,style:o,styles:c,className:d}),...x})});ye.classes=Y;ye.displayName="@mantine/core/ModalOverlay";const Qs={__staticSelector:"Modal",closeOnClickOutside:!0,withinPortal:!0,lockScroll:!0,trapFocus:!0,returnFocus:!0,closeOnEscape:!0,keepMounted:!1,zIndex:xe("modal"),transitionProps:{duration:200,transition:"fade-down"},yOffset:"5dvh"},et=ms((s,{radius:a,size:l,yOffset:t,xOffset:d})=>({root:{"--modal-radius":a===void 0?void 0:ps(a),"--modal-size":fs(l,"modal-size"),"--modal-y-offset":Be(t),"--modal-x-offset":Be(d)}})),Ce=ne((s,a)=>{const l=W("ModalRoot",Qs,s),{classNames:t,className:d,style:o,styles:c,unstyled:i,vars:x,yOffset:m,scrollAreaComponent:C,radius:z,fullScreen:R,centered:T,xOffset:F,__staticSelector:A,...r}=l,p=gs({name:A,classes:Y,props:l,className:d,style:o,classNames:t,styles:c,unstyled:i,vars:x,varsResolver:et});return e.jsx(Zs,{value:{yOffset:m,scrollAreaComponent:C,getStyles:p,fullScreen:R},children:e.jsx(Fe,{ref:a,...p("root"),"data-full-screen":R||void 0,"data-centered":T||void 0,unstyled:i,...r})})});Ce.classes=Y;Ce.displayName="@mantine/core/ModalRoot";const[st,tt]=js();function Ge({children:s}){const[a,l]=w.useState([]),[t,d]=w.useState(xe("modal"));return e.jsx(st,{value:{stack:a,addModal:(o,c)=>{l(i=>[...new Set([...i,o])]),d(i=>typeof c=="number"&&typeof i=="number"?Math.max(i,c):i)},removeModal:o=>l(c=>c.filter(i=>i!==o)),getZIndex:o=>`calc(${t} + ${a.indexOf(o)} + 1)`,currentId:a[a.length-1],maxZIndex:t},children:s})}Ge.displayName="@mantine/core/ModalStack";const nt={},we=ne((s,a)=>{const l=W("ModalTitle",nt,s),{classNames:t,className:d,style:o,styles:c,vars:i,...x}=l,m=ue();return e.jsx(qe,{ref:a,...m.getStyles("title",{classNames:t,style:o,styles:c,className:d}),...x})});we.classes=Y;we.displayName="@mantine/core/ModalTitle";const at={closeOnClickOutside:!0,withinPortal:!0,lockScroll:!0,trapFocus:!0,returnFocus:!0,closeOnEscape:!0,keepMounted:!1,zIndex:xe("modal"),transitionProps:{duration:200,transition:"fade-down"},withOverlay:!0,withCloseButton:!0},H=ne((s,a)=>{const{title:l,withOverlay:t,overlayProps:d,withCloseButton:o,closeButtonProps:c,children:i,radius:x,opened:m,stackId:C,zIndex:z,...R}=W("Modal",at,s),T=tt(),F=!!l||o,A=T&&C?{closeOnEscape:T.currentId===C,trapFocus:T.currentId===C,zIndex:T.getZIndex(C)}:{},r=t===!1?!1:C&&T?T.currentId===C:m;return w.useEffect(()=>{T&&C&&(m?T.addModal(C,z||xe("modal")):T.removeModal(C))},[m,C,z]),e.jsxs(Ce,{ref:a,radius:x,opened:m,zIndex:T&&C?T.getZIndex(C):z,...R,...A,children:[t&&e.jsx(ye,{visible:r,transitionProps:T&&C?{duration:0}:void 0,...d}),e.jsxs(ve,{radius:x,__hidden:T&&C&&m?C!==T.currentId:!1,children:[F&&e.jsxs(_e,{children:[l&&e.jsx(we,{children:l}),o&&e.jsx(be,{...c})]}),e.jsx(je,{children:i})]})]})});H.classes=Y;H.displayName="@mantine/core/Modal";H.Root=Ce;H.Overlay=ye;H.Content=ve;H.Body=je;H.Header=_e;H.Title=we;H.CloseButton=be;H.Stack=Ge;/**
 * @license @tabler/icons-react v3.29.0 - MIT
 *
 * This source code is licensed under the MIT license.
 * See the LICENSE file in the root directory of this source tree.
 */var Ze=re("outline","chevron-right","IconChevronRight",[["path",{d:"M9 6l6 6l-6 6",key:"svg-0"}]]);/**
 * @license @tabler/icons-react v3.29.0 - MIT
 *
 * This source code is licensed under the MIT license.
 * See the LICENSE file in the root directory of this source tree.
 */var lt=re("outline","devices","IconDevices",[["path",{d:"M13 9a1 1 0 0 1 1 -1h6a1 1 0 0 1 1 1v10a1 1 0 0 1 -1 1h-6a1 1 0 0 1 -1 -1v-10z",key:"svg-0"}],["path",{d:"M18 8v-3a1 1 0 0 0 -1 -1h-13a1 1 0 0 0 -1 1v12a1 1 0 0 0 1 1h9",key:"svg-1"}],["path",{d:"M16 9h2",key:"svg-2"}]]);/**
 * @license @tabler/icons-react v3.29.0 - MIT
 *
 * This source code is licensed under the MIT license.
 * See the LICENSE file in the root directory of this source tree.
 */var ze=re("outline","edit","IconEdit",[["path",{d:"M7 7h-1a2 2 0 0 0 -2 2v9a2 2 0 0 0 2 2h9a2 2 0 0 0 2 -2v-1",key:"svg-0"}],["path",{d:"M20.385 6.585a2.1 2.1 0 0 0 -2.97 -2.97l-8.415 8.385v3h3l8.385 -8.415z",key:"svg-1"}],["path",{d:"M16 5l3 3",key:"svg-2"}]]);/**
 * @license @tabler/icons-react v3.29.0 - MIT
 *
 * This source code is licensed under the MIT license.
 * See the LICENSE file in the root directory of this source tree.
 */var rt=re("outline","file-export","IconFileExport",[["path",{d:"M14 3v4a1 1 0 0 0 1 1h4",key:"svg-0"}],["path",{d:"M11.5 21h-4.5a2 2 0 0 1 -2 -2v-14a2 2 0 0 1 2 -2h7l5 5v5m-5 6h7m-3 -3l3 3l-3 3",key:"svg-1"}]]);/**
 * @license @tabler/icons-react v3.29.0 - MIT
 *
 * This source code is licensed under the MIT license.
 * See the LICENSE file in the root directory of this source tree.
 */var it=re("outline","player-pause","IconPlayerPause",[["path",{d:"M6 5m0 1a1 1 0 0 1 1 -1h2a1 1 0 0 1 1 1v12a1 1 0 0 1 -1 1h-2a1 1 0 0 1 -1 -1z",key:"svg-0"}],["path",{d:"M14 5m0 1a1 1 0 0 1 1 -1h2a1 1 0 0 1 1 1v12a1 1 0 0 1 -1 1h-2a1 1 0 0 1 -1 -1z",key:"svg-1"}]]);/**
 * @license @tabler/icons-react v3.29.0 - MIT
 *
 * This source code is licensed under the MIT license.
 * See the LICENSE file in the root directory of this source tree.
 */var Ne=re("outline","plus","IconPlus",[["path",{d:"M12 5l0 14",key:"svg-0"}],["path",{d:"M5 12l14 0",key:"svg-1"}]]);/**
 * @license @tabler/icons-react v3.29.0 - MIT
 *
 * This source code is licensed under the MIT license.
 * See the LICENSE file in the root directory of this source tree.
 */var Ie=re("outline","trash","IconTrash",[["path",{d:"M4 7l16 0",key:"svg-0"}],["path",{d:"M10 11l0 6",key:"svg-1"}],["path",{d:"M14 11l0 6",key:"svg-2"}],["path",{d:"M5 7l1 12a2 2 0 0 0 2 2h8a2 2 0 0 0 2 -2l1 -12",key:"svg-3"}],["path",{d:"M9 7v-3a1 1 0 0 1 1 -1h4a1 1 0 0 1 1 1v3",key:"svg-4"}]]);const dt=({config:s,onChange:a})=>{const l=t=>{a({...s,...t})};return e.jsx(q,{gap:"md",children:e.jsxs(y,{children:[e.jsx(y.Col,{span:{base:12,sm:6},children:e.jsx(le,{label:"Baud Rate",value:String(s.baud_rate),onChange:t=>l({baud_rate:Number(t)}),data:Ms.map(t=>({value:String(t),label:String(t)})),required:!0})}),e.jsx(y.Col,{span:{base:12,sm:6},children:e.jsx(le,{label:"Data Bits",value:String(s.data_bits),onChange:t=>l({data_bits:Number(t)}),data:Bs.map(t=>({value:String(t.value),label:t.label})),required:!0})}),e.jsx(y.Col,{span:{base:12,sm:6},children:e.jsx(le,{label:"Parity",value:s.parity,onChange:t=>l({parity:t}),data:ks.map(t=>({value:t.value,label:t.label})),required:!0})}),e.jsx(y.Col,{span:{base:12,sm:6},children:e.jsx(le,{label:"Stop Bits",value:String(s.stop_bits),onChange:t=>l({stop_bits:Number(t)}),data:zs.map(t=>({value:String(t.value),label:t.label})),required:!0})}),e.jsx(y.Col,{span:{base:12,sm:6},children:e.jsx(X,{label:"Timeout (ms)",value:s.timeout_ms,onChange:t=>l({timeout_ms:Number(t)}),min:100,max:5e3,step:100,required:!0})})]})})},ot=({slaves:s,onEdit:a,onDelete:l,onAdd:t})=>{const d=bs(),o=vs({uuid:"4880c12c-fdcb-4077-8920-a450d7f9b907"}),{characteristic:c}=o.useBluetoothCharacteristic({uuid:"fec26ec4-6d71-4442-9f81-55bc21d658d6"}),[i,x]=w.useState(null),[m,C]=w.useState({}),[z,R]=w.useState([]),T=r=>(r.blocks||[]).reduce((p,S)=>{var b;return p+(((b=S.registers)==null?void 0:b.length)||0)},0),F=r=>{R(p=>p.includes(r)?p.filter(S=>S!==r):[...p,r])},A=async(r,p,S)=>{var f,N;if(!d.isConnected){I.show({message:"Not connected to device. Please connect via Bluetooth first.",color:"red"});return}if(!c){I.show({message:"Bluetooth characteristic not available. Please reconnect.",color:"red"});return}const b=`${r.slave_id}-${p.block_id}-${S.reg_id}`;x(b);try{const L=await new ws(c).readRegisterLive(r.slave_id,S.address,S.length,p.function_code);if(L.status==="success"&&L.data){const g=L.data,k=g.raw_values||[],M=g.timestamp||new Date().toISOString();let O;const D=g.interpretations;if(k.length>=2&&D){let E;const U=((f=S.data_type)==null?void 0:f.toLowerCase())||"uint16",Q=((N=S.endianness)==null?void 0:N.toLowerCase())||"big";if(U.includes("float"))switch(Q){case"big":E=D.float32_big_endian_ABCD;break;case"little":E=D.float32_little_endian_DCBA;break;case"mid_big":E=D.float32_mid_big_BADC;break;case"mid_little":E=D.float32_mid_little_CDAB;break;default:E=D.float32_big_endian_ABCD}else(U.includes("int32")||U.includes("uint32"))&&(Q==="big"||Q==="mid_big"?E=U.includes("uint")?D.uint32_big_endian:D.int32_big_endian:E=U.includes("uint")?D.uint32_little_endian:D.int32_little_endian);E!==void 0&&!isNaN(E)&&isFinite(E)?O=`${(E*(S.scale_factor||1)+(S.offset||0)).toFixed(4)} ${S.unit||""}`.trim():O="Invalid float value"}else k.length>0?O=`${(k[0]*(S.scale_factor||1)+(S.offset||0)).toFixed(2)} ${S.unit||""}`.trim():O="No data";C({...m,[b]:{value:O,rawValues:k,rawHex:g.raw_hex,hexValues:g.hex_values,interpretations:D,timestamp:M}}),I.show({message:`Successfully read ${S.name}: ${O}`,color:"green"})}else throw new Error(L.message||"Failed to read register")}catch(v){I.show({message:`Failed to read register: ${v.message||v}`,color:"red"}),console.error("Read register error:",v)}finally{x(null)}};return e.jsxs(q,{gap:"md",children:[s.length===0&&e.jsx(_,{c:"dimmed",ta:"center",py:"xl",children:'No Modbus slaves configured. Click "Add Slave" to get started.'}),s.map(r=>e.jsxs(_s,{withBorder:!0,padding:"md",children:[e.jsxs(B,{justify:"space-between",mb:"xs",wrap:"wrap",children:[e.jsxs(B,{wrap:"wrap",children:[e.jsxs(_,{fw:600,size:"lg",children:["Slave ID ",r.slave_id,": ",r.name]}),e.jsx(Z,{color:r.enabled?"green":"gray",children:r.enabled?"Enabled":"Disabled"})]}),e.jsxs(B,{gap:"xs",children:[e.jsx(te,{variant:"light",color:"blue",onClick:()=>a(r),"aria-label":"Edit slave",children:e.jsx(ze,{size:16})}),e.jsx(te,{variant:"light",color:"red",onClick:()=>l(r.slave_id),"aria-label":"Delete slave",children:e.jsx(Ie,{size:16})})]})]}),e.jsxs(_,{size:"sm",c:"dimmed",children:[e.jsx("strong",{children:"Type:"})," ",r.device_type]}),e.jsxs(_,{size:"sm",c:"dimmed",mb:"md",children:[e.jsx("strong",{children:"Blocks:"})," ",(r.blocks||[]).length," | ",e.jsx("strong",{children:"Registers:"})," ",T(r)]}),(r.blocks||[]).length>0&&e.jsx(q,{gap:"xs",children:r.blocks.map(p=>{var f,N;const S=`${r.slave_id}-${p.block_id}`,b=z.includes(S);return e.jsxs(se,{p:"sm",withBorder:!0,radius:"md",children:[e.jsx(B,{justify:"space-between",wrap:"nowrap",style:{cursor:"pointer"},onClick:()=>F(S),children:e.jsxs(B,{gap:"xs",children:[e.jsx(te,{variant:"subtle",size:"sm",children:b?e.jsx(De,{size:16}):e.jsx(Ze,{size:16})}),e.jsxs("div",{children:[e.jsxs(B,{gap:"xs",mb:2,children:[e.jsx(_,{size:"sm",fw:600,children:p.name}),e.jsxs(Z,{size:"xs",variant:"light",color:"blue",children:["FC",p.function_code]}),e.jsxs(Z,{size:"xs",variant:"outline",children:[((f=p.registers)==null?void 0:f.length)||0," reg",(((N=p.registers)==null?void 0:N.length)||0)!==1?"s":""]}),!p.enabled&&e.jsx(Z,{size:"xs",variant:"light",color:"gray",children:"Disabled"})]}),e.jsxs(_,{size:"xs",c:"dimmed",children:["Addr ",p.start_address,"–",p.start_address+p.length-1]})]})]})}),e.jsx(Pe,{in:b,children:e.jsx(ce,{mt:"sm",pl:"lg",style:{borderLeft:"2px solid var(--mantine-color-gray-3)"},children:(p.registers||[]).length>0?e.jsx(fe,{variant:"separated",children:p.registers.map((v,L)=>{var O,D,E,U,Q,he;const g=`${r.slave_id}-${p.block_id}-${v.reg_id}`,k=i===g,M=m[g];return e.jsxs(fe.Item,{value:`reg-${g}`,children:[e.jsx(fe.Control,{children:e.jsxs(B,{justify:"space-between",wrap:"nowrap",children:[e.jsxs("div",{children:[e.jsx(_,{size:"sm",fw:500,children:v.name}),e.jsxs(_,{size:"xs",c:"dimmed",children:["Addr: ",v.address," | Len: ",v.length," | Type:"," ",v.data_type]})]}),e.jsx(Z,{size:"sm",color:v.enabled?"green":"gray",children:v.enabled?"ON":"OFF"})]})}),e.jsx(fe.Panel,{children:e.jsxs(q,{gap:"xs",children:[e.jsxs(y,{children:[e.jsx(y.Col,{span:6,children:e.jsxs(_,{size:"xs",c:"dimmed",children:["Register ID: ",v.reg_id]})}),e.jsx(y.Col,{span:6,children:e.jsxs(_,{size:"xs",c:"dimmed",children:["Address: ",v.address]})}),e.jsx(y.Col,{span:6,children:e.jsxs(_,{size:"xs",c:"dimmed",children:["Length: ",v.length," registers"]})}),e.jsx(y.Col,{span:6,children:e.jsxs(_,{size:"xs",c:"dimmed",children:["Function Code: ",p.function_code," (from block)"]})}),e.jsx(y.Col,{span:6,children:e.jsxs(_,{size:"xs",c:"dimmed",children:["Data Type: ",v.data_type]})}),e.jsx(y.Col,{span:6,children:e.jsxs(_,{size:"xs",c:"dimmed",children:["Endianness: ",v.endianness]})}),e.jsx(y.Col,{span:6,children:e.jsxs(_,{size:"xs",c:"dimmed",children:["Scale: ",v.scale_factor||1]})}),e.jsx(y.Col,{span:6,children:e.jsxs(_,{size:"xs",c:"dimmed",children:["Offset: ",v.offset||0]})}),v.unit&&e.jsx(y.Col,{span:6,children:e.jsxs(_,{size:"xs",c:"dimmed",children:["Unit: ",v.unit]})})]}),e.jsxs(B,{justify:"space-between",mt:"xs",children:[e.jsx(ys,{label:"Read live data from this register via RS485",children:e.jsx(V,{size:"xs",variant:"light",leftSection:k?e.jsx(Cs,{size:14}):e.jsx(As,{size:14}),onClick:()=>A(r,p,v),disabled:k||!d.isConnected,children:k?"Reading...":"Read Live"})}),M&&e.jsxs(_,{size:"sm",fw:500,c:"green",children:["✓ ",M.value]})]}),M&&e.jsx(se,{withBorder:!0,p:"xs",mt:"sm",bg:"gray.0",children:e.jsxs(q,{gap:"xs",children:[e.jsx(_,{size:"xs",fw:600,c:"blue",children:"Debug Information"}),e.jsxs(B,{gap:"xs",children:[e.jsx(_,{size:"xs",c:"dimmed",children:"Raw Values (DEC):"}),e.jsx($,{fz:"xs",children:((O=M.rawValues)==null?void 0:O.join(", "))||"N/A"})]}),M.rawHex&&e.jsxs(B,{gap:"xs",children:[e.jsx(_,{size:"xs",c:"dimmed",children:"Raw Values (HEX):"}),e.jsx($,{fz:"xs",c:"blue",children:M.rawHex})]}),M.hexValues&&e.jsxs(B,{gap:"xs",children:[e.jsx(_,{size:"xs",c:"dimmed",children:"Registers:"}),M.hexValues.map((Se,ge)=>e.jsxs($,{fz:"xs",children:["Reg",ge,": 0x",Se]},ge))]}),((D=M.interpretations)==null?void 0:D.raw_bytes)&&e.jsxs(B,{gap:"xs",children:[e.jsx(_,{size:"xs",c:"dimmed",children:"Raw Bytes:"}),e.jsx($,{fz:"xs",c:"orange",children:M.interpretations.raw_bytes})]}),M.interpretations&&e.jsxs(e.Fragment,{children:[e.jsx(ke,{my:"xs",label:"Float32 Interpretations",labelPosition:"left"}),e.jsxs(h,{withTableBorder:!0,children:[e.jsx(h.Thead,{children:e.jsxs(h.Tr,{children:[e.jsx(h.Th,{children:"Format"}),e.jsx(h.Th,{children:"Value"})]})}),e.jsxs(h.Tbody,{children:[e.jsxs(h.Tr,{children:[e.jsx(h.Td,{children:e.jsx($,{fz:"xs",children:"Big Endian (ABCD)"})}),e.jsx(h.Td,{fw:500,children:((E=M.interpretations.float32_big_endian_ABCD)==null?void 0:E.toFixed(6))??"N/A"})]}),e.jsxs(h.Tr,{children:[e.jsx(h.Td,{children:e.jsx($,{fz:"xs",children:"Little Endian (DCBA)"})}),e.jsx(h.Td,{fw:500,children:((U=M.interpretations.float32_little_endian_DCBA)==null?void 0:U.toFixed(6))??"N/A"})]}),e.jsxs(h.Tr,{children:[e.jsx(h.Td,{children:e.jsx($,{fz:"xs",children:"Mid-Big (BADC)"})}),e.jsx(h.Td,{fw:500,children:((Q=M.interpretations.float32_mid_big_BADC)==null?void 0:Q.toFixed(6))??"N/A"})]}),e.jsxs(h.Tr,{children:[e.jsx(h.Td,{children:e.jsx($,{fz:"xs",children:"Mid-Little (CDAB)"})}),e.jsx(h.Td,{fw:500,children:((he=M.interpretations.float32_mid_little_CDAB)==null?void 0:he.toFixed(6))??"N/A"})]})]})]}),e.jsx(ke,{my:"xs",label:"Integer Interpretations",labelPosition:"left"}),e.jsxs(h,{withTableBorder:!0,children:[e.jsx(h.Thead,{children:e.jsxs(h.Tr,{children:[e.jsx(h.Th,{children:"Format"}),e.jsx(h.Th,{children:"Value"})]})}),e.jsxs(h.Tbody,{children:[e.jsxs(h.Tr,{children:[e.jsx(h.Td,{children:e.jsx($,{fz:"xs",children:"UInt32 BE"})}),e.jsx(h.Td,{children:M.interpretations.uint32_big_endian??"N/A"})]}),e.jsxs(h.Tr,{children:[e.jsx(h.Td,{children:e.jsx($,{fz:"xs",children:"UInt32 LE"})}),e.jsx(h.Td,{children:M.interpretations.uint32_little_endian??"N/A"})]}),e.jsxs(h.Tr,{children:[e.jsx(h.Td,{children:e.jsx($,{fz:"xs",children:"Int32 BE"})}),e.jsx(h.Td,{children:M.interpretations.int32_big_endian??"N/A"})]}),e.jsxs(h.Tr,{children:[e.jsx(h.Td,{children:e.jsx($,{fz:"xs",children:"Int32 LE"})}),e.jsx(h.Td,{children:M.interpretations.int32_little_endian??"N/A"})]}),e.jsxs(h.Tr,{children:[e.jsx(h.Td,{children:e.jsx($,{fz:"xs",children:"UInt16 Reg0"})}),e.jsx(h.Td,{children:M.interpretations.uint16_reg0??"N/A"})]}),e.jsxs(h.Tr,{children:[e.jsx(h.Td,{children:e.jsx($,{fz:"xs",children:"UInt16 Reg1"})}),e.jsx(h.Td,{children:M.interpretations.uint16_reg1??"N/A"})]}),e.jsxs(h.Tr,{children:[e.jsx(h.Td,{children:e.jsx($,{fz:"xs",children:"Int16 Reg0"})}),e.jsx(h.Td,{children:M.interpretations.int16_reg0??"N/A"})]}),e.jsxs(h.Tr,{children:[e.jsx(h.Td,{children:e.jsx($,{fz:"xs",children:"Int16 Reg1"})}),e.jsx(h.Td,{children:M.interpretations.int16_reg1??"N/A"})]})]})]})]}),e.jsxs(_,{size:"xs",c:"dimmed",children:["Read at: ",new Date(M.timestamp).toLocaleString()]})]})})]})})]},L)})}):e.jsx(_,{size:"xs",c:"dimmed",ta:"center",py:"xs",children:"No registers in this block"})})})]},p.block_id)})}),(r.blocks||[]).length===0&&e.jsx(_,{size:"sm",c:"dimmed",ta:"center",py:"md",children:"No blocks configured for this slave"})]},r.slave_id)),e.jsx(V,{leftSection:e.jsx(Ne,{size:16}),onClick:t,fullWidth:!0,children:"Add Slave Device"})]})},ct={length:1,data_type:"uint16",endianness:"big",scale_factor:1,offset:0,unit:"",enabled:!0},ut={enabled:!0,registers:[]},ht={device_type:"Generic",enabled:!0,blocks:[]},xt=({opened:s,onClose:a,onSave:l,slave:t,existingSlaveIds:d})=>{const o=!!t,[c,i]=w.useState(!1),[x,m]=w.useState(1),[C,z]=w.useState(""),[R,T]=w.useState(""),[F,A]=w.useState(!0),[r,p]=w.useState([]),[S,b]=w.useState(null),[f,N]=w.useState({}),[v,L]=w.useState(null),[g,k]=w.useState({}),[M,O]=w.useState([]);w.useEffect(()=>{t?(m(t.slave_id),z(t.name),T(t.device_type),A(t.enabled),p(t.blocks||[])):(m(1),z(""),T(""),A(!0),p([])),b(null),N({}),L(null),k({}),O([])},[t,s]);const D=()=>{if(r.length>=10){I.show({message:"Maximum 10 blocks per slave allowed",color:"orange"});return}b(-1),N({block_id:`block_${r.length+1}`,name:`Block ${r.length+1}`,start_address:0,length:10,function_code:3,enabled:!0})},E=n=>{b(n);const u=r[n];N({block_id:u.block_id,name:u.name,start_address:u.start_address,length:u.length,function_code:u.function_code,enabled:u.enabled})},U=()=>{if(!f.block_id||!f.name){I.show({message:"Block ID and Name are required",color:"red"});return}if((f.length||1)>125){I.show({message:"Block length cannot exceed 125 registers (Modbus protocol limit)",color:"red"});return}if(r.some((u,P)=>u.block_id===f.block_id&&P!==S)){I.show({message:"Block ID must be unique",color:"red"});return}if(S===-1){const u={...ut,block_id:f.block_id,name:f.name,start_address:f.start_address||0,length:f.length||10,function_code:f.function_code||3,enabled:f.enabled!==!1,registers:[]};p([...r,u]),O([...M,u.block_id])}else if(S!==null){const u=[...r];u[S]={...u[S],block_id:f.block_id,name:f.name,start_address:f.start_address||0,length:f.length||10,function_code:f.function_code||3,enabled:f.enabled!==!1},p(u)}b(null),N({})},Q=n=>{const u=r[n],G=u.registers&&u.registers.length>0?`Delete block "${u.name}" and its ${u.registers.length} register(s)?`:`Delete block "${u.name}"?`;window.confirm(G)&&(p(r.filter((K,ee)=>ee!==n)),O(M.filter(K=>K!==u.block_id)))},he=()=>{b(null),N({})},Se=n=>{const u=r[n];if(u.registers.length>=20){I.show({message:"Maximum 20 registers per block allowed",color:"orange"});return}L({blockIndex:n,regIndex:-1}),k({reg_id:"",name:"",enabled:!0,address:u.start_address,length:1,data_type:"uint16",endianness:"big",scale_factor:1,offset:0,unit:""})},ge=(n,u)=>{L({blockIndex:n,regIndex:u}),k({...r[n].registers[u]})},Ke=()=>{if(!v)return;const{blockIndex:n,regIndex:u}=v,P=r[n];if(!g.reg_id||!g.name){I.show({message:"Register ID and Name are required",color:"red"});return}const G=g.address||0,j=g.length||1,K=P.start_address,ee=P.start_address+P.length-1;if(G<K||G>ee){I.show({message:`Register address ${G} must be within block range (${K}-${ee})`,color:"red"});return}if(G+j-1>ee){I.show({message:`Register address + length exceeds block end address (${ee})`,color:"red"});return}if(P.registers.some((me,es)=>me.reg_id===g.reg_id&&es!==u)){I.show({message:"Register ID must be unique within the block",color:"red"});return}const Re={...ct,reg_id:g.reg_id,name:g.name,address:g.address||P.start_address,length:g.length||1,data_type:g.data_type||"uint16",endianness:g.endianness||"big",scale_factor:g.scale_factor??1,offset:g.offset??0,unit:g.unit||"",enabled:g.enabled!==!1},Te=[...r];if(u===-1)Te[n].registers=[...P.registers,Re];else{const me=[...P.registers];me[u]=Re,Te[n].registers=me}p(Te),L(null),k({})},Xe=(n,u)=>{const P=r[n].registers[u];if(window.confirm(`Delete register "${P.name}"?`)){const j=[...r];j[n].registers=r[n].registers.filter((K,ee)=>ee!==u),p(j)}},We=()=>{L(null),k({})},Je=async()=>{if(!C.trim()){I.show({message:"Slave name is required",color:"red"});return}if(x<ie.SLAVE_ID_MIN||x>ie.SLAVE_ID_MAX){I.show({message:`Slave ID must be between ${ie.SLAVE_ID_MIN} and ${ie.SLAVE_ID_MAX}`,color:"red"});return}if((!o||t.slave_id!==x)&&d.includes(x)){I.show({message:`Slave ID ${x} is already in use`,color:"red"});return}if(!(r.length===0&&!window.confirm("No blocks configured. Do you want to save anyway?"))){i(!0);try{const n={slave_id:x,name:C.trim(),device_type:R.trim()||ht.device_type,enabled:F,blocks:r};await l(n),I.show({message:`Slave ${o?"updated":"added"} successfully`,color:"green"}),a()}catch{}finally{i(!1)}}},Ye=n=>{O(u=>u.includes(n)?u.filter(P=>P!==n):[...u,n])},Qe=r.reduce((n,u)=>n+u.registers.length,0);return e.jsx(H,{opened:s,onClose:a,title:e.jsx(_,{size:"lg",fw:600,children:o?"Edit Modbus Slave":"Add Modbus Slave"}),size:"xl",closeOnClickOutside:!1,children:e.jsxs(q,{gap:"md",children:[e.jsxs(y,{children:[e.jsx(y.Col,{span:{base:12,sm:6},children:e.jsx(X,{label:"Slave ID",value:x,onChange:n=>m(Number(n)),min:ie.SLAVE_ID_MIN,max:ie.SLAVE_ID_MAX,required:!0,disabled:o,description:o?"Slave ID cannot be changed":"1-247"})}),e.jsx(y.Col,{span:{base:12,sm:6},children:e.jsx(ae,{label:"Slave Name",value:C,onChange:n=>z(n.currentTarget.value),required:!0,placeholder:"e.g., Energy Meter"})}),e.jsx(y.Col,{span:{base:12,sm:6},children:e.jsx(ae,{label:"Device Type",value:R,onChange:n=>T(n.currentTarget.value),placeholder:"e.g., energy_meter"})}),e.jsx(y.Col,{span:12,children:e.jsx(pe,{label:"Enabled",checked:F,onChange:n=>A(n.currentTarget.checked),description:"Enable/disable polling for this slave"})})]}),e.jsx(ke,{label:"Block Configuration",labelPosition:"center"}),e.jsxs(q,{gap:"xs",children:[e.jsxs(B,{justify:"space-between",children:[e.jsxs(q,{gap:2,children:[e.jsxs(_,{size:"sm",fw:500,children:["Blocks (",r.length,"/10)"]}),e.jsxs(_,{size:"xs",c:"dimmed",children:["Total registers: ",Qe]})]}),e.jsx(V,{leftSection:e.jsx(Ne,{size:16}),onClick:D,size:"xs",disabled:S!==null||r.length>=10,children:"Add Block"})]}),S!==null&&e.jsx(se,{p:"md",radius:"md",withBorder:!0,style:{borderColor:"var(--mantine-color-blue-4)",backgroundColor:"var(--mantine-color-blue-0)"},children:e.jsxs(q,{gap:"xs",children:[e.jsx(_,{size:"sm",fw:600,c:"blue",children:S===-1?"New Block":"Edit Block"}),e.jsxs(y,{children:[e.jsx(y.Col,{span:{base:12,sm:6},children:e.jsx(ae,{label:"Block ID",value:f.block_id||"",onChange:n=>N({...f,block_id:n.currentTarget.value}),required:!0,placeholder:"e.g., voltage_block"})}),e.jsx(y.Col,{span:{base:12,sm:6},children:e.jsx(ae,{label:"Block Name",value:f.name||"",onChange:n=>N({...f,name:n.currentTarget.value}),required:!0,placeholder:"e.g., Voltage Readings"})}),e.jsx(y.Col,{span:{base:12,sm:4},children:e.jsx(le,{label:"Function Code",value:String(f.function_code||3),onChange:n=>N({...f,function_code:Number(n)}),data:Ns.map(n=>({value:String(n.value),label:n.label}))})}),e.jsx(y.Col,{span:{base:12,sm:4},children:e.jsx(X,{label:"Start Address",value:f.start_address||0,onChange:n=>N({...f,start_address:Number(n)}),min:0,max:65535})}),e.jsx(y.Col,{span:{base:12,sm:4},children:e.jsx(X,{label:"Length (registers)",description:"1-125",value:f.length||10,onChange:n=>N({...f,length:Number(n)}),min:1,max:125})}),e.jsx(y.Col,{span:12,children:e.jsxs(_,{size:"xs",c:"dimmed",children:["Address range: ",f.start_address||0," – ",(f.start_address||0)+(f.length||10)-1]})}),e.jsx(y.Col,{span:12,children:e.jsx(pe,{label:"Enabled",checked:f.enabled!==!1,onChange:n=>N({...f,enabled:n.currentTarget.checked})})})]}),e.jsxs(B,{justify:"flex-end",gap:"xs",children:[e.jsx(V,{variant:"light",onClick:he,size:"xs",children:"Cancel"}),e.jsxs(V,{onClick:U,size:"xs",children:[S===-1?"Add":"Update"," Block"]})]})]})}),r.length>0&&e.jsx(q,{gap:"xs",children:r.map((n,u)=>{const P=M.includes(n.block_id),G=(v==null?void 0:v.blockIndex)===u;return e.jsxs(se,{p:"sm",withBorder:!0,radius:"md",children:[e.jsxs(B,{justify:"space-between",wrap:"nowrap",children:[e.jsxs(B,{gap:"xs",style:{cursor:"pointer",flex:1},onClick:()=>Ye(n.block_id),children:[e.jsx(te,{variant:"subtle",size:"sm",children:P?e.jsx(De,{size:16}):e.jsx(Ze,{size:16})}),e.jsxs("div",{children:[e.jsxs(B,{gap:"xs",mb:2,children:[e.jsx(_,{size:"sm",fw:600,children:n.name}),e.jsxs(Z,{size:"xs",variant:"light",color:"blue",children:["FC",n.function_code]}),e.jsxs(Z,{size:"xs",variant:"outline",children:[n.registers.length," reg",n.registers.length!==1?"s":""]}),!n.enabled&&e.jsx(Z,{size:"xs",variant:"light",color:"gray",children:"Disabled"})]}),e.jsxs(_,{size:"xs",c:"dimmed",children:[n.block_id," | Addr ",n.start_address,"–",n.start_address+n.length-1]})]})]}),e.jsxs(B,{gap:"xs",children:[e.jsx(te,{variant:"light",color:"blue",onClick:j=>{j.stopPropagation(),E(u)},disabled:S!==null||v!==null,children:e.jsx(ze,{size:16})}),e.jsx(te,{variant:"light",color:"red",onClick:j=>{j.stopPropagation(),Q(u)},disabled:S!==null||v!==null,children:e.jsx(Ie,{size:16})})]})]}),e.jsx(Pe,{in:P,children:e.jsxs(ce,{mt:"sm",pl:"lg",style:{borderLeft:"2px solid var(--mantine-color-gray-3)"},children:[e.jsxs(B,{justify:"space-between",mb:"xs",children:[e.jsxs(_,{size:"xs",fw:500,c:"dimmed",children:["Registers (",n.registers.length,"/20)"]}),e.jsx(V,{leftSection:e.jsx(Ne,{size:14}),onClick:()=>Se(u),size:"xs",variant:"light",disabled:v!==null||S!==null||n.registers.length>=20,children:"Add Register"})]}),G&&e.jsx(se,{p:"sm",radius:"md",mb:"xs",withBorder:!0,style:{borderColor:"var(--mantine-color-green-4)",backgroundColor:"var(--mantine-color-green-0)"},children:e.jsxs(q,{gap:"xs",children:[e.jsx(_,{size:"xs",fw:600,c:"green",children:(v==null?void 0:v.regIndex)===-1?"New Register":"Edit Register"}),e.jsxs(y,{children:[e.jsx(y.Col,{span:{base:12,sm:6},children:e.jsx(ae,{label:"Register ID",value:g.reg_id||"",onChange:j=>k({...g,reg_id:j.currentTarget.value}),required:!0,placeholder:"e.g., voltage_l1",size:"xs"})}),e.jsx(y.Col,{span:{base:12,sm:6},children:e.jsx(ae,{label:"Name",value:g.name||"",onChange:j=>k({...g,name:j.currentTarget.value}),required:!0,placeholder:"e.g., Voltage L1",size:"xs"})}),e.jsx(y.Col,{span:{base:12,sm:4},children:e.jsx(X,{label:"Address",description:`${n.start_address}-${n.start_address+n.length-1}`,value:g.address||n.start_address,onChange:j=>k({...g,address:Number(j)}),min:n.start_address,max:n.start_address+n.length-1,size:"xs"})}),e.jsx(y.Col,{span:{base:12,sm:4},children:e.jsx(X,{label:"Length",value:g.length||1,onChange:j=>k({...g,length:Number(j)}),min:1,max:4,size:"xs"})}),e.jsx(y.Col,{span:{base:12,sm:4},children:e.jsx(le,{label:"Data Type",value:g.data_type||"uint16",onChange:j=>k({...g,data_type:j}),data:Is.map(j=>({value:j.value,label:j.label})),size:"xs"})}),e.jsx(y.Col,{span:{base:12,sm:4},children:e.jsx(le,{label:"Endianness",value:g.endianness||"big",onChange:j=>k({...g,endianness:j}),data:Rs.map(j=>({value:j.value,label:j.label})),size:"xs"})}),e.jsx(y.Col,{span:{base:12,sm:4},children:e.jsx(X,{label:"Scale Factor",value:g.scale_factor??1,onChange:j=>k({...g,scale_factor:Number(j)}),step:.1,decimalScale:4,size:"xs"})}),e.jsx(y.Col,{span:{base:12,sm:4},children:e.jsx(X,{label:"Offset",value:g.offset??0,onChange:j=>k({...g,offset:Number(j)}),step:.1,decimalScale:4,size:"xs"})}),e.jsx(y.Col,{span:{base:12,sm:6},children:e.jsx(ae,{label:"Unit",value:g.unit||"",onChange:j=>k({...g,unit:j.currentTarget.value}),placeholder:"e.g., V, A, W",size:"xs"})}),e.jsx(y.Col,{span:{base:12,sm:6},children:e.jsx(pe,{label:"Enabled",checked:g.enabled!==!1,onChange:j=>k({...g,enabled:j.currentTarget.checked}),mt:"md"})})]}),e.jsxs(B,{justify:"flex-end",gap:"xs",children:[e.jsx(V,{variant:"light",onClick:We,size:"xs",children:"Cancel"}),e.jsxs(V,{onClick:Ke,size:"xs",color:"green",children:[(v==null?void 0:v.regIndex)===-1?"Add":"Update"," Register"]})]})]})}),n.registers.length>0?e.jsx(q,{gap:4,children:n.registers.map((j,K)=>e.jsx(se,{p:"xs",withBorder:!0,radius:"sm",bg:"gray.0",children:e.jsxs(B,{justify:"space-between",wrap:"nowrap",children:[e.jsxs("div",{style:{flex:1},children:[e.jsxs(B,{gap:"xs",mb:2,children:[e.jsx(_,{size:"xs",fw:500,children:j.name}),!j.enabled&&e.jsx(Z,{size:"xs",variant:"light",color:"gray",children:"Off"})]}),e.jsxs(_,{size:"xs",c:"dimmed",ff:"monospace",children:[j.reg_id," | Addr:",j.address," | Len:",j.length," | ",j.data_type,j.unit&&` | ${j.unit}`]})]}),e.jsxs(B,{gap:4,children:[e.jsx(te,{variant:"subtle",size:"sm",color:"blue",onClick:()=>ge(u,K),disabled:v!==null||S!==null,children:e.jsx(ze,{size:14})}),e.jsx(te,{variant:"subtle",size:"sm",color:"red",onClick:()=>Xe(u,K),disabled:v!==null||S!==null,children:e.jsx(Ie,{size:14})})]})]})},j.reg_id))}):!G&&e.jsx(_,{size:"xs",c:"dimmed",ta:"center",py:"xs",children:'No registers in this block. Click "Add Register" to add one.'})]})})]},n.block_id)})}),r.length===0&&S===null&&e.jsxs(se,{p:"md",withBorder:!0,radius:"md",bg:"gray.0",children:[e.jsx(_,{size:"sm",c:"dimmed",ta:"center",children:'No blocks configured. Click "Add Block" to create a register block.'}),e.jsx(_,{size:"xs",c:"dimmed",ta:"center",mt:"xs",children:"Each block reads a contiguous range of Modbus registers in a single request. Add registers under each block to define what data to extract."})]})]}),e.jsxs(B,{justify:"flex-end",mt:"md",children:[e.jsx(V,{variant:"light",onClick:a,disabled:c,children:"Cancel"}),e.jsxs(V,{onClick:Je,loading:c,children:[o?"Update":"Add"," Slave"]})]})]})})},St=()=>{const s=Es(),[a,l]=w.useState(null),[t,d]=w.useState(!1),[o,c]=w.useState(null),[i,x]=w.useState(!1),[m,C]=w.useState(!1);w.useEffect(()=>{s.modbusConfig&&(l(s.modbusConfig),s.modbusConfig.read_paused!==void 0&&x(s.modbusConfig.read_paused))},[s.modbusConfig]);const z=async()=>{if(!a){I.show({message:"No configuration to save",color:"red"});return}try{await s.saveModbusConfig({uart_config:a.uart_config,retry_count:a.retry_count})}catch{}},R=async b=>{if(window.confirm(`Are you sure you want to delete Slave ID ${b}? This action cannot be undone.`))try{await s.deleteSlave(b)}catch{}},T=b=>{c(b),d(!0)},F=()=>{c(null),d(!0)},A=()=>{d(!1),c(null)},r=async b=>{C(!0);try{await s.pauseModbusRead(b),x(b),I.show({message:b?"Modbus reading paused":"Modbus reading resumed",color:b?"orange":"green"})}catch{}finally{C(!1)}},p=async b=>{if(b)try{const f=await b.text(),N=JSON.parse(f),v=N.modbus_config||N;if(!v.uart_config){I.show({message:"Invalid configuration file: missing uart_config",color:"red"});return}await s.importModbusConfig(v)}catch(f){I.show({message:`Failed to import: ${f instanceof Error?f.message:"Invalid JSON file"}`,color:"red"})}},S=async b=>{o?await s.updateSlave(b.slave_id,b):await s.addSlave(b),await s.loadModbusConfig()};return e.jsxs(q,{gap:"md",children:[e.jsxs(B,{justify:"space-between",wrap:"wrap",children:[e.jsx(_,{size:"xl",fw:700,children:"Modbus Configuration"}),e.jsxs(B,{wrap:"wrap",children:[e.jsx(V,{variant:"light",leftSection:e.jsx(Ds,{size:16}),onClick:()=>s.loadModbusConfig(),loading:s.isLoading,children:"Get Config"}),e.jsx(V,{variant:"light",color:"teal",leftSection:e.jsx(rt,{size:16}),onClick:()=>s.exportModbusConfig(),disabled:!a,children:"Export"}),e.jsx(He,{onChange:p,accept:"application/json,.json",children:b=>e.jsx(V,{variant:"light",color:"orange",leftSection:e.jsx(Ps,{size:16}),loading:s.isLoading,...b,children:"Import"})})]})]}),!a&&!s.isLoading&&e.jsx(_,{c:"dimmed",ta:"center",py:"xl",children:'Click "Get Config" to load current Modbus configuration'}),a&&e.jsxs(e.Fragment,{children:[e.jsx(Me,{title:"Modbus Polling Control",icon:i?e.jsx(it,{size:20,color:"var(--mantine-color-orange-6)"}):e.jsx(Ss,{size:20,color:"var(--mantine-color-green-6)"}),children:e.jsxs(B,{align:"center",gap:"md",children:[e.jsx(pe,{size:"lg",color:i?"orange":"green",checked:i,onChange:b=>r(b.currentTarget.checked),disabled:m,label:"Pause Modbus Read",description:"Temporarily stops data collection polling so BLE commands and live reads respond faster"}),e.jsx(Z,{color:i?"orange":"green",size:"lg",variant:"light",children:i?"Polling Paused":"Polling Active"})]})}),e.jsxs(Me,{title:"UART Configuration",icon:e.jsx(Ts,{size:20}),children:[e.jsx(dt,{config:a.uart_config,onChange:b=>l({...a,uart_config:b})}),e.jsx(y,{mt:"md",children:e.jsx(y.Col,{span:12,children:e.jsx(X,{label:"Retry Count",value:a.retry_count,onChange:b=>l({...a,retry_count:Number(b)}),min:1,max:10,description:"Number of retries on communication failure"})})}),e.jsx(B,{justify:"flex-end",mt:"md",children:e.jsx(V,{onClick:z,loading:s.isLoading,children:"Save UART Config"})})]}),e.jsx(Me,{title:"Modbus Slave Devices",icon:e.jsx(lt,{size:20}),children:e.jsx(ot,{slaves:a.slaves||[],onEdit:T,onDelete:R,onAdd:F})})]}),e.jsx(xt,{opened:t,onClose:A,onSave:S,slave:o,existingSlaveIds:((a==null?void 0:a.slaves)||[]).map(b=>b.slave_id)})]})};export{St as default};
