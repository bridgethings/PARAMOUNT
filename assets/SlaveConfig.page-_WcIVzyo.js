import{s as F,j as e,S as I,G as d,v as j,w as l,T as c,x as m,t as _,J as h,N as G,y as z,O as Z,M as ee,A as se}from"./index-PTjFC09f.js";import{C as T}from"./ConfigCard-Bm8nn3Gy.js";import{B as ae,D as ne,P as ie,S as te}from"./configOptions-DKBD50gn.js";import{N as w}from"./NumberInput-Yg5CGcNz.js";import{c as le,b as re,I as oe,M as de,T as ce}from"./TestReadPanel-B6y8QQ64.js";import{T as i}from"./Table-BDAThvQd.js";import{T as U}from"./TextInput-DMiFZDiy.js";import{I as $}from"./IconCheck-Xn7Y-yWz.js";import{u as ue}from"./useConfiguration-BA0L4BRG.js";import{I as he}from"./IconDownload-CPWeDuNP.js";import{B as me}from"./Badge-B309Sa-B.js";/**
 * @license @tabler/icons-react v3.29.0 - MIT
 *
 * This source code is licensed under the MIT license.
 * See the LICENSE file in the root directory of this source tree.
 */var xe=F("outline","player-pause","IconPlayerPause",[["path",{d:"M6 5m0 1a1 1 0 0 1 1 -1h2a1 1 0 0 1 1 1v12a1 1 0 0 1 -1 1h-2a1 1 0 0 1 -1 -1z",key:"svg-0"}],["path",{d:"M14 5m0 1a1 1 0 0 1 1 -1h2a1 1 0 0 1 1 1v12a1 1 0 0 1 -1 1h-2a1 1 0 0 1 -1 -1z",key:"svg-1"}]]);/**
 * @license @tabler/icons-react v3.29.0 - MIT
 *
 * This source code is licensed under the MIT license.
 * See the LICENSE file in the root directory of this source tree.
 */var q=F("outline","x","IconX",[["path",{d:"M18 6l-12 12",key:"svg-0"}],["path",{d:"M6 6l12 12",key:"svg-1"}]]);const ge=({config:n,onChange:t})=>{const o=a=>{t({...n,...a})};return e.jsx(I,{gap:"md",children:e.jsxs(d,{children:[e.jsx(d.Col,{span:{base:12,sm:6},children:e.jsx(j,{label:"Baud Rate",value:String(n.baud_rate),onChange:a=>o({baud_rate:Number(a)}),data:ae.map(a=>({value:String(a),label:String(a)})),required:!0})}),e.jsx(d.Col,{span:{base:12,sm:6},children:e.jsx(j,{label:"Data Bits",value:String(n.data_bits),onChange:a=>o({data_bits:Number(a)}),data:ne.map(a=>({value:String(a.value),label:a.label})),required:!0})}),e.jsx(d.Col,{span:{base:12,sm:6},children:e.jsx(j,{label:"Parity",value:n.parity,onChange:a=>o({parity:a}),data:ie.map(a=>({value:a.value,label:a.label})),required:!0})}),e.jsx(d.Col,{span:{base:12,sm:6},children:e.jsx(j,{label:"Stop Bits",value:String(n.stop_bits),onChange:a=>o({stop_bits:Number(a)}),data:te.map(a=>({value:String(a.value),label:a.label})),required:!0})}),e.jsx(d.Col,{span:{base:12,sm:6},children:e.jsx(w,{label:"Timeout (ms)",value:n.timeout_ms,onChange:a=>o({timeout_ms:Number(a)}),min:100,max:5e3,step:100,required:!0})})]})})},je=({slaves:n,profiles:t,onAdd:o,onUpdate:a,onDelete:v})=>{const[f,x]=l.useState(!1),[p,b]=l.useState(null),[g,r]=l.useState(null),[y,X]=l.useState(""),[C,P]=l.useState(1),[k,N]=l.useState(""),[S,A]=l.useState(""),[R,E]=l.useState(!0),[M,B]=l.useState(""),[D,L]=l.useState(""),O=t.map(s=>({value:s.profile_id,label:`${s.profile_id} (${s.make} ${s.model})`})),H=n.map(s=>s.slave_id),J=()=>{x(!0);let s=1;for(;H.includes(s)&&s<=247;)s++;P(s),N(""),A(t.length>0?t[0].profile_id:""),E(!0)},Y=async()=>{S&&(await o({slave_id:C,profile_id:S,name:k||`Slave ${C}`,enabled:R}),x(!1))},K=s=>{b(s.slave_id),B(s.name),L(s.profile_id)},Q=async s=>{await a(s,{name:M,profile_id:D}),b(null)},V=async s=>{window.confirm(`Delete Slave ${s}?`)&&await v(s)},W=(s,u)=>{r(s),X(u)};return e.jsxs(e.Fragment,{children:[e.jsxs(I,{gap:"sm",children:[e.jsxs(i,{withTableBorder:!0,striped:!0,highlightOnHover:!0,children:[e.jsx(i.Thead,{children:e.jsxs(i.Tr,{children:[e.jsx(i.Th,{children:"ID"}),e.jsx(i.Th,{children:"Name"}),e.jsx(i.Th,{children:"Profile"}),e.jsx(i.Th,{children:"Enabled"}),e.jsx(i.Th,{children:"Actions"})]})}),e.jsxs(i.Tbody,{children:[n.map(s=>e.jsxs(i.Tr,{children:[e.jsx(i.Td,{children:e.jsx(c,{size:"sm",ff:"monospace",fw:600,children:s.slave_id})}),e.jsx(i.Td,{children:p===s.slave_id?e.jsx(U,{value:M,onChange:u=>B(u.currentTarget.value),size:"xs",maxLength:31}):e.jsx(c,{size:"sm",children:s.name})}),e.jsx(i.Td,{children:p===s.slave_id?e.jsx(j,{data:O,value:D,onChange:u=>L(u||""),size:"xs"}):e.jsxs(m,{gap:"xs",children:[e.jsx(c,{size:"sm",children:s.profile_id}),s.profile&&e.jsxs(c,{size:"xs",c:"dimmed",children:["(",s.profile.make," ",s.profile.model,")"]})]})}),e.jsx(i.Td,{children:e.jsx(_,{checked:s.enabled,onChange:u=>a(s.slave_id,{enabled:u.currentTarget.checked}),size:"xs"})}),e.jsx(i.Td,{children:e.jsx(m,{gap:4,wrap:"nowrap",children:p===s.slave_id?e.jsxs(e.Fragment,{children:[e.jsx(h,{variant:"subtle",color:"green",size:"sm",onClick:()=>Q(s.slave_id),children:e.jsx($,{size:14})}),e.jsx(h,{variant:"subtle",size:"sm",onClick:()=>b(null),children:e.jsx(q,{size:14})})]}):e.jsxs(e.Fragment,{children:[e.jsx(h,{variant:"subtle",size:"sm",onClick:()=>K(s),children:e.jsx(le,{size:14})}),e.jsx(h,{variant:"subtle",size:"sm",color:"blue",onClick:()=>W(s.slave_id,s.profile_id),children:e.jsx(G,{size:14})}),e.jsx(h,{variant:"subtle",size:"sm",color:"red",onClick:()=>V(s.slave_id),children:e.jsx(re,{size:14})})]})})})]},s.slave_id)),f&&e.jsxs(i.Tr,{children:[e.jsx(i.Td,{children:e.jsx(w,{value:C,onChange:s=>P(Number(s)),min:1,max:247,size:"xs",w:70})}),e.jsx(i.Td,{children:e.jsx(U,{value:k,onChange:s=>N(s.currentTarget.value),placeholder:"Slave name",size:"xs",maxLength:31})}),e.jsx(i.Td,{children:e.jsx(j,{data:O,value:S,onChange:s=>A(s||""),size:"xs",placeholder:"Select profile"})}),e.jsx(i.Td,{children:e.jsx(_,{checked:R,onChange:s=>E(s.currentTarget.checked),size:"xs"})}),e.jsx(i.Td,{children:e.jsxs(m,{gap:4,wrap:"nowrap",children:[e.jsx(h,{variant:"subtle",color:"green",size:"sm",onClick:Y,disabled:!S,children:e.jsx($,{size:14})}),e.jsx(h,{variant:"subtle",size:"sm",onClick:()=>x(!1),children:e.jsx(q,{size:14})})]})})]})]})]}),n.length===0&&!f&&e.jsx(c,{size:"sm",c:"dimmed",ta:"center",py:"md",children:"No slave devices configured."}),!f&&e.jsxs(m,{justify:"flex-start",children:[e.jsx(z,{size:"xs",variant:"light",leftSection:e.jsx(oe,{size:14}),onClick:J,disabled:t.length===0,children:"Add Slave"}),t.length===0&&e.jsx(c,{size:"xs",c:"dimmed",children:"Create a device profile first"})]})]}),e.jsx(de,{opened:g!==null,onClose:()=>r(null),title:`Test Read â€” Slave ${g}`,size:"lg",children:g!==null&&y&&e.jsx(ce,{profileId:y,defaultSlaveId:g})})]})},ye=()=>{const n=ue(),[t,o]=l.useState(null),[a,v]=l.useState(!1),[f,x]=l.useState(!1);l.useEffect(()=>{n.modbusConfig&&(o(n.modbusConfig),n.modbusConfig.read_paused!==void 0&&v(n.modbusConfig.read_paused))},[n.modbusConfig]);const p=async()=>{await n.loadModbusConfig(),await n.loadSlaves(),await n.loadProfiles()},b=async()=>{if(t)try{await n.saveModbusUART({uart_config:t.uart_config,retry_count:t.retry_count})}catch{}},g=async r=>{x(!0);try{await n.pauseModbusRead(r),v(r),se.show({message:r?"Modbus reading paused":"Modbus reading resumed",color:r?"orange":"green"})}catch{}finally{x(!1)}};return e.jsxs(I,{gap:"md",children:[e.jsxs(m,{justify:"space-between",wrap:"wrap",children:[e.jsx(c,{size:"xl",fw:700,children:"Slave Configuration"}),e.jsx(z,{variant:"light",leftSection:e.jsx(he,{size:16}),onClick:p,loading:n.isLoading,children:"Load Config"})]}),!t&&!n.isLoading&&e.jsx(c,{c:"dimmed",ta:"center",py:"xl",children:'Click "Load Config" to load current configuration'}),t&&e.jsxs(e.Fragment,{children:[e.jsx(T,{title:"Modbus Polling Control",icon:a?e.jsx(xe,{size:20,color:"var(--mantine-color-orange-6)"}):e.jsx(G,{size:20,color:"var(--mantine-color-green-6)"}),children:e.jsxs(m,{align:"center",gap:"md",children:[e.jsx(_,{size:"lg",color:a?"orange":"green",checked:a,onChange:r=>g(r.currentTarget.checked),disabled:f,label:"Pause Modbus Read",description:"Temporarily stops polling so BLE commands respond faster"}),e.jsx(me,{color:a?"orange":"green",size:"lg",variant:"light",children:a?"Polling Paused":"Polling Active"})]})}),e.jsxs(T,{title:"UART Configuration",icon:e.jsx(Z,{size:20}),children:[e.jsx(ge,{config:t.uart_config,onChange:r=>o({...t,uart_config:r})}),e.jsx(d,{mt:"md",children:e.jsx(d.Col,{span:12,children:e.jsx(w,{label:"Retry Count",value:t.retry_count,onChange:r=>o({...t,retry_count:Number(r)}),min:1,max:10,description:"Number of retries on communication failure"})})}),e.jsx(m,{justify:"flex-end",mt:"md",children:e.jsx(z,{onClick:b,loading:n.isLoading,children:"Save UART Config"})})]}),e.jsx(T,{title:"Slave Assignments",icon:e.jsx(ee,{size:20}),children:e.jsx(je,{slaves:n.slaves,profiles:n.profiles,onAdd:n.addSlave,onUpdate:n.updateSlave,onDelete:n.deleteSlave})})]})]})};export{ye as default};
